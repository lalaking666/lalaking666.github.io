{"posts":[{"title":"JSé€†å‘1: æœ‰é“ç¿»è¯‘signå‚æ•°è¿˜åŸä»¥åŠapiè¿”å›æ•°æ®è§£å¯†","text":"å‘ç°æœ‰é“ç¿»è¯‘çš„apiè¿”å›ç»“æœç°åœ¨æ”¹æˆå¯†æ–‡äº†ï¼Œæ¥è¯•è¯•çœ‹ 1. ç›®æ ‡ç›®æ ‡API: https://dict.youdao.com/webtranslate è¯·æ±‚æ–¹å¼ä¸ºPOSTæ–¹å¼ï¼Œè¡¨å•æäº¤çš„å†…å®¹ä¸­å­—æ®µsignä¸ºç­¾åï¼Œå¹¶ä¸”æ¥å£è¿”å›å†…å®¹ä¸ºå¯†æ–‡ï¼Œçœ‹èµ·æ¥æ˜¯base64ã€‚ 2. è¿˜åŸSIGNè€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆå…¨å±€æœç´¢signï¼Œåœ¨æ–‡ä»¶app.f59abb30.jsä¸­å‘ç°å¯ç–‘çš„åœ°æ–¹ã€‚ è°ƒè¯•ä¸€ä¸‹ï¼Œbå‡½æ•°æ¥å—çš„å‚æ•°ä¸­tä¸ºæ¯«ç§’æ—¶é—´æˆ³ã€eçš„å€¼å›ºå®š:fsdsogkndfokasodnasoã€‚bå†…éƒ¨å¯¹eå’Œtè¿›è¡Œäº†æ‹¼æ¥ï¼Œåç”±på‡½æ•°è¿›è¡Œè®¡ç®—å¾—å‡ºæœ€ç»ˆsignå€¼ã€‚ på‡½æ•°ä¸­æ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸º:client=fanyideskweb&amp;mysticTime=1676711201946&amp;product=webfanyi&amp;key=fsdsogkndfokasodnasoã€‚ ç„¶åå¯¹på‡½æ•°ä¼ ä¸€ä¸ªç©ºå€¼å¾—å‡ºd41d8cd98f00b204e9800998ecf8427eï¼Œæ˜æ˜¾på‡½æ•°æ˜¯ç›´æ¥è°ƒç”¨äº†md5ç®—æ³•ã€‚ å°æ€»ç»“ï¼šsignçš„ç»“æœç”±å½“å‰çš„æ¯«ç§’æ—¶é—´æˆ³ä¸ä¸€äº›å›ºå®šå­—ç¬¦ä¸²æ‹¼æ¥åè¿›è¡Œmd5å¾—å‡ºã€‚3. è§£å¯†æ¥å£è¿”å›ç»“æœ3.1 Hook javascriptçš„jsonç›¸å…³å‡½æ•°:1234567891011const my_stringify= JSON.stringify;JSON.stringify = function (params){ console.log(&quot;xxx&quot;,params); return my_stringify(params); };const my_parse = JSON.parse;JSON.parse = function (params){ console.log(&quot;xxx&quot;,params); return my_parse(params); }; åœ¨consoleè¯­å¥ä¸Šæ‰“debuggeræŸ¥çœ‹è°ƒç”¨æ ˆåæ‰¾åˆ°è§£å¯†ä½ç½®ï¼š è¿™é‡Œæ³¨æ„å…³é”®å‡½æ•°createDecipherivè¿™æ˜¯nodejsä¸­ç”¨äºå¯¹ç§°åŠ å¯†ç®—æ³•è§£å¯†ç›¸å…³çš„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåŠ å¯†ç®—æ³•ç±»å‹ï¼Œç¬¬äºŒå€¼å‚æ•°ä¸ºåŠ å¯†çš„keyï¼Œå› ä¸ºè¿™é‡Œæ˜¯aesçš„cbcæ¨¡å¼æ‰€ä»¥ç¬¬ä¸‰ä¸ªå€¼åº”è¯¥ä¸ºivå€¼ã€‚ 3.2 ç”¨pythonè¿˜åŸ:12345678910111213141516171819202122from Crypto.Cipher import AESfrom Crypto.Hash import MD5import base64from Crypto.Util.Padding import pad, unpaddef test_decrypt(decrypt_str): key = &quot;key&quot; iv = &quot;iv&quot; key = MD5.new(key.encode('utf8')).digest() iv = MD5.new(iv.encode('utf8')).digest() aes = AES.new(key, mode=AES.MODE_CBC, iv=iv) # decrypt_res = pad(decrypt_str.encode('utf8'), 16) # c = aes.decrypt(base64.b64decode(decrypt_str)) c = aes.decrypt(base64.urlsafe_b64decode(decrypt_str)) return unpad(c, AES.block_size).decode('utf8')if __name__ == &quot;__main__&quot;: decrypt_str = &quot;_jsUyA02rwkOJ4enKX7c4dhd7CjvGkcKfbRx0BjNGW_hwjE_2PiqPiM3vVr4Y05h0zY-PcyS28K16rKbb8q0Ma-qFiwk4jcdmZC34DcQsRF7kehjfLzArYdnCq-e09t-zhPi6UAlDgqVJeO_JGDg1veCbE-PBw_YawOjiZ7AEEcXJ9HvpazfDznmVv2cGhEUzn6npkrdLdHpe23yeNiUTOmUIsZVmmBQmv4vEoY_N3c=&quot; c = test_decrypt(decrypt_str) print(c) 3.3 å°ç»†èŠ‚è¿™é‡Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œæ¥å£è¿”å›çš„base64å€¼å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„base64å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜ç§ï¼šå°†Base64ä¸­çš„+å’Œ/æ”¹ä¸ºäº†åœ¨urlä¸­ä¸ä¼šè¢«ç¼–ç çš„_å’Œ/ã€‚åœ¨pythonè§£ç base64æ—¶éœ€è¦ç”¨urlsafe_b64decodeå‡½æ•°ã€‚ 4. æ€»ç»“è¿™ä¸ªç½‘ç«™è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œåªæ˜¯base64è§£ç é‚£éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œä½œè€…åœ¨è¿™å¡äº†å¥½ä¹…ã€‚","link":"/posts/78f06c31.html"},{"title":"flask-restfulç¼–å†™ä¸Šä¼ å›¾ç‰‡api","text":"Flask-RESTfulæ˜¯ç”¨äºå¿«é€Ÿæ„å»ºREST APIçš„Flaskæ‰©å±•ã€‚æˆ‘æœ€è¿‘åœ¨ä½¿ç”¨Flask-Restful + Vue.jså†™ä¸€ä¸ªè½»é‡åšå®¢æ—¶æœ‰ä¸€ä¸ªå‰ç«¯åç«¯ä¸Šä¼ å›¾ç‰‡çš„éœ€æ±‚ã€‚åœ¨Flask-Restfulçš„å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç›¸å…³çš„å†…å®¹ã€‚ä¸‹é¢æ˜¯æˆ‘è°·æ­ŒæŸ¥æ‰¾èµ„æ–™çš„æ€»ç»“ã€‚ å¼•å…¥FileStorageflask-restfulçš„å‚æ•°è§£æä¸­å¹¶æ²¡æœ‰æ–‡ä»¶ç±»å‹ï¼Œéœ€è¦å¼•å…¥werkzeug.datastructures.FileStorageä½œä¸ºå‚æ•°è§£æä¸­çš„ç±»å‹ã€‚ä¸Šä¼ å›¾ç‰‡çš„èµ„æºapiå¯ä»¥è¿™æ ·ç¼–å†™ï¼š 123456789101112class UploadImg(Resource): def __init__(self): # åˆ›å»ºä¸€ä¸ªæ–°çš„è§£æå™¨ self.parser = reqparse.RequestParser() # å¢åŠ imgFileå‚æ•°ï¼Œç”¨æ¥è§£æå‰ç«¯ä¼ æ¥çš„å›¾ç‰‡ã€‚ self.parser.add_argument('imgFile', required=True, type=FileStorage,location='files',help=&quot;imgFile is wrong.&quot;) def post(self): img_file = self.parser.parse_args().get('imgFile') # ä¿å­˜å›¾ç‰‡ img_file.save(img_file.filename) return 'ok', 201 FileStorageè¿™ä¸ªç±»æœ‰å¾ˆå¤šçš„å†…ç½®æ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨äº†saveæ–¹æ³•ä¿å­˜äº†å›¾ç‰‡ï¼Œsaveæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°æºç é‡Œé¢è¯´æ˜å¦‚ä¸‹ï¼šdstæŒ‡å®šä¿å­˜æ–‡ä»¶çš„name. 12345def save(self, dst, buffer_size=16384): :param dst: a filename, :class:`os.PathLike`, or open file object to write to. :param buffer_size: Passed as the ``length`` parameter of :func:`shutil.copyfileobj`. å®Œæ•´ä»£ç 12345678910111213141516171819202122232425#!/usr/bin/env python# encoding: utf-8from flask_restful import reqparse, Resource, Apifrom werkzeug.datastructures import FileStoragefrom flask import Flaskclass UploadImg(Resource): def __init__(self): # åˆ›å»ºä¸€ä¸ªæ–°çš„è§£æå™¨ self.parser = reqparse.RequestParser() # å¢åŠ imgFileå‚æ•°ï¼Œç”¨æ¥è§£æå‰ç«¯ä¼ æ¥çš„å›¾ç‰‡ã€‚ self.parser.add_argument('imgFile', required=True, type=FileStorage,location='files',help=&quot;imgFile is wrong.&quot;) def post(self): img_file = self.parser.parse_args().get('imgFile') img_file.save(img_file.filename) return 'ok', 201if __name__ == '__main__': app = Flask(__name__) api = Api(app) api.add_resource(UploadImg, '/uploadimg') app.run()","link":"/posts/9e5a0e91.html"},{"title":"python+requestsçˆ¬è™«æ¾æ¹ƒæ–°é—»æŸæ¡æ–°é—»ä¸‹çš„è¯„è®º","text":"å¦‚é¢˜ä¾‹å¦‚æŠ“å–è¿™ä¸ªæ–‡ç« ä¸‹çš„æ‰€æœ‰è¯„è®ºï¼šé“¾æ¥ã€‚é¦–å…ˆï¼Œåˆ—å‡ºéœ€è¦æŠ“å–çš„æ•°æ®ï¼š æ–°é—»æ ‡é¢˜ æ–°é—»å‘å¸ƒæ—¥æœŸ è¯„è®ºè€…çš„æ˜µç§° è¯„è®ºçš„å†…å®¹ åˆ†æç½‘é¡µè¯·æ±‚æ‰¾åˆ°éœ€è¦çš„æ•°æ®çœ‹ä¸‹å›¾ï¼Œåœ¨ç½‘é¡µçš„ç¬¬ä¸€ä¸ªè¯·æ±‚é‡Œé¢å·²ç»åŒ…æ‹¬äº†1ï¼Œ2ä¸¤æ¡çš„æ•°æ®ã€‚æ¥ç€åœ¨æµè§ˆå™¨ä¸­å‘ä¸‹æ»‘åŠ¨æ–°é—»ç½‘é¡µåŠ è½½è¯„è®ºï¼ŒåŒæ—¶å…³æ³¨æ§åˆ¶å°ï¼Œæ³¨æ„æœç´¢æ¡†é‡Œçš„loadï¼Œå¦‚ä¸‹å›¾æµè§ˆå™¨ä¼šä¸æ–­çš„å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªè¯·æ±‚çš„ç›¸åº”é‡Œé¢å°±åŒ…å«äº†éœ€è¦çš„3ï¼Œ4æ¡(è¯„è®ºï¼Œè¯„è®ºè€…çš„ç”¨æˆ·å)æ•°æ®ã€‚çœ‹ä¸€ä¸‹è¿™ä¸ªè¯·æ±‚çš„urlæœ‰ä¸€å †çš„è¯·æ±‚å‚æ•°å°è¯•ç²¾ç®€ä¸‹æœ€åå¾—åˆ°è¿™æ ·çš„urlhttps://www.thepaper.cn/load_moreFloorComment.jsp?contid=4489661startId=24750775ã€‚åœ¨è¿™ä¸ªurlé‡Œé¢åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–°é—»çš„idï¼Œç¬¬äºŒæ˜¯è¯„è®ºé¡µçš„idã€‚æœ‰äº†è¿™ä¸ªurlå°±å¯ä»¥æ ¹æ®ä¸åŒçš„startidæ„é€ å‡ºè¯„è®ºçš„urlæœ€ç»ˆçš„æŠ“åˆ°æ‰€æœ‰çš„è¯„è®ºä¿¡æ¯ã€‚ æ€ä¹ˆæ‰¾åˆ°ä¸åŒçš„startidï¼ŸåŒæ ·æ˜¯ä¸Šé¢é‚£ä¸ªå›¾ï¼Œåœ¨æ–°æ ‡ç­¾æ‰“å¼€å¯¹åº”çš„è¯·æ±‚ï¼Œçœ‹ä¸€ä¸‹htmlæºç ï¼Œåœ¨ç¬¬ä¸€æ¡è¯„è®ºdivé‡Œé¢æœ‰ä¸€ä¸ªstartid=â€™24745735â€™ã€‚è®°ä½è¿™ä¸ªå€¼ï¼Œå†å›å»çœ‹ä¸€ä¸‹ç¬¬äºŒæ¡è¯·æ±‚è¯„è®ºçš„urlï¼Œå‘ç°æœ€åçš„startidå€¼å°±æ˜¯ç¬¬ä¸€æ¡è¯·æ±‚è¯„è®ºçš„urlé‡Œé¢çš„startidå€¼ã€‚å°±æ˜¯è¿™ä¸ªæ ·å­ï¼šè‡³æ­¤ï¼Œæ‰€æœ‰çš„æ•°æ®ç†è®ºä¸Šæ¥è¯´éƒ½å¯ä»¥æ‰¾åˆ°äº†ã€‚å‰©ä¸‹çš„å°±æ˜¯å†™ä»£ç äº†ã€‚ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120#!/usr/bin/env python# -*- coding: utf-8 -*-# ************************************************************************# *# * @file:penpai.py# * @author:kanhui# * date:2019-09-22 11:40:30# * @version 3.7.3# *# ************************************************************************import requestsimport refrom lxml import etreeimport jsonclass PengPaiSpider(): ''' ç»™å®šä¸€ä¸ªæ¾æ¹ƒæ–°é—»çš„urlçˆ¬å–å…¶ä¸‹çš„è¯„è®ºä¿¡æ¯ ä¾‹å¦‚ï¼šhttps://www.thepaper.cn/newsDetail_forward_1292455 ''' def __init__(self): print('input url:') # æ–°é—»urlåœ°å€ self.url = input() # ç”¨æ¥åˆ¤æ–­æ˜¯å¦åˆ°è¾¾æœ€åä¸€é¡µï¼Œåœ¨è¯·æ±‚è¯„è®ºé¡µé¢æ—¶çš„ç¬¬ä¸€æ¡è¯„è®ºé‡Œæœ‰ä¸€ä¸ªstartIdå‚æ•°å¦‚æœä¸º0åˆ™è¡¨ç¤ºæ²¡æœ‰ä¸‹ä¸€é¡µäº† self.next_id = '' # ç”¨æ¥å­˜å‚¨çˆ¬åˆ°çš„æ•°æ® self.item = {} # è¯·æ±‚å¤´ self.header = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36' } # å°è¯•è·å–contid å¦‚æœè·å–ä¸åˆ°åˆ™è®¾ç½®ä¸º0ç¨‹åºç»“æŸ self.contid = re.findall(r'forward_(\\d*)', self.url)[0] if len( re.findall(r'forward_(\\d*)', self.url)) is not 0 else 0 self.comment_url = 'https://www.thepaper.cn/load_moreFloorComment.jsp?contid={}&amp;startId={}' if self.contid == 0: print('è·å–contidå¤±è´¥ï¼Œæ£€æŸ¥url!!') def parse(self, url): '''å‘é€è¯·æ±‚å‡½æ•°''' res = requests.get(url) # è°ƒè¯•ç¨‹åº print(url) return res.text def start(self): # è·å–æ–°é—»ä¿¡æ¯,å¹¶è·å–è¯„è®ºæ¡æ•° self.get_new_data() while self.next_id is not 0: res = self.parse(self.comment_url.format(self.contid,self.next_id)) # æ ¹æ®reså†…å®¹æå–æ•°æ® self.handle(res) # å­˜å‚¨å•æ¡è¯„è®º self.save_comment() def handle(self, res): root = etree.HTML(res) comments = root.xpath( &quot;//div[@class='comment_que']//div[@class='ansright_cont']/a/text()&quot; ) usernames = root.xpath('.//h3/a/text()') self.item = [{ 'Nickname': username, 'content': comment } for username, comment in zip(usernames, comments)] # æ›´æ–°ä¸‹ä¸€ä¸ªurl # new_next_id = int(root.xpath('//div[@class=&quot;comment_que&quot;]')[0].xpath('./div')[1].xpath('@startid')[0]) new_next_id = int(re.findall(r'startId=&quot;(.*?)&quot;', res)[0]) # è€å¸ˆç»™çš„urlå¥½åƒæœ‰ç‚¹å°é—®é¢˜ï¼Œéœ€è¦å‡14æ‰èƒ½è·³è½¬åˆ°ä¸‹ä¸€é¡µï¼Œå¦åˆ™ä¼šåœ¨å‰ä¸¤é¡µå·²çŸ¥å¾ªç¯ if self.next_id == new_next_id: self.next_id = new_next_id - 14 else: self.next_id = new_next_id def get_new_data(self): '''ç”¨æ¥è·å–æ–°é—»çš„ä¿¡æ¯''' res = self.parse(self.url) root = etree.HTML(res) self.item['é“¾æ¥'] = self.url tmp = root.xpath(&quot;//h1[@class='news_title']/text()&quot;) self.item['æ ‡é¢˜'] = tmp[0] if len(tmp) is not 0 else '' tmp = root.xpath(&quot;//h2[@id='comm_span']/span/text()&quot;) if len(tmp) is not 0: self.comment_count = re.findall(r'\\ï¼ˆ(.*)\\ï¼‰', tmp[0])[0] if self.comment_count.isdigit(): self.item['è¯„è®ºæ•°'] = self.comment_count else:# å¤„ç†æ˜¯3.2kè¿™ç§æƒ…å†µ self.comment_count = float(self.comment_count[:-1]) * 1000 self.item['è¯„è®ºæ•°'] = self.comment_count tmp = root.xpath('//div[@class=&quot;news_about&quot;]/p/text()') if len(tmp) == 3: # ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å–æ—¶é—´ post_time = re.findall(r'(\\d{4}-\\d{2}-\\d{2})', tmp[1])[0] if len( re.findall(r'(\\d{4}-\\d{2}-\\d{2})', tmp[1])) is not 0 else '' self.item['æ—¶é—´'] = post_time self.save_comment() def save_comment(self): with open(self.contid + '.json', 'a') as f: f.write(json.dumps(self.item, ensure_ascii=False, indent=4))if __name__ == '__main__': my_spider = PengPaiSpider() my_spider.start() print('å®Œæˆï¼')","link":"/posts/ccc2cbf8.html"},{"title":"Picgoæ­å»ºGithubå›¾åºŠä½¿ç”¨Jsdelivrçš„æ­£ç¡®å§¿åŠ¿","text":"è®°å½•ä¸€ä¸‹ä½¿ç”¨github + picgoæ­å»ºå›¾åºŠçš„æµç¨‹ ç”±äºä¸€äº›å–œé—»ä¹è§çš„åŸå› ï¼Œgithubåœ¨æˆ‘ä»¬å›½å®¶çš„è®¿é—®é€Ÿåº¦å¹¶ä¸æµç•…ï¼Œå› æ­¤åœ¨ä½¿ç”¨githubæ­å»ºå›¾åºŠæ—¶æ¨èä½¿ç”¨jsdelivrè¿›è¡ŒcdnåŠ é€Ÿï¼Œæ ¹æ®ç½‘ç»œä¸Šçš„å¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æ˜¯åœ¨è®¾å®šä»“åº“åæ—¶è¿›è¡Œcdnè®¾ç½®ï¼šhttps://cdn.jsdelivr.net/gh/[ç”¨æˆ·å]/[ä»“åº“å]ã€‚å¦‚å›¾ï¼š æˆ‘å°è¯•äº†å¾ˆå¤šæ¬¡ï¼Œè¿™ç§æ–¹æ³•å¹¶ä¸èƒ½æˆåŠŸã€‚æŸ¥çœ‹picgoé”™è¯¯æ—¥å¿—ï¼š StatusCodeError: 404 - {&quot;message&quot;:&quot;Not Found&quot;,&quot;documentation_url&quot;:&quot;https://docs.github.com/rest/reference/repos#create-or-update-file-contents&quot;} è¿™ä¸ªé”™è¯¯çš„å¤§è‡´æ„æ€å°±æ˜¯æ‰¾ä¸åˆ°æŒ‡å®šçš„urlé“¾æ¥ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜åªéœ€è¦åœ¨è®¾å®šè‡ªå®šä¹‰åŸŸåçš„ä½ç½®æ·»åŠ cdnåŠ é€Ÿå°±å¯ä»¥äº†ï¼Œå¦‚å›¾: è‡ªå®šä¹‰åŸŸåå¤„å¡«å†™https://cdn.jsdelivr.net/gh/huihuidehui/github-pic@mainæ­¤å¤„çš„mainè¦å’Œè®¾å®šçš„åˆ†æ”¯åä¿æŒä¸€è‡´ã€‚ æœ€ç»ˆå®ç°æ•ˆæœåœ¨typoraä¸­ç¼–å†™markdownæ–‡æ¡£ï¼Œè¿›è¡Œå›¾ç‰‡æ’å…¥æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨picgoå°†å›¾ç‰‡ä¸Šä¼ åˆ°githubå›¾åºŠï¼Œæˆªå›¾ååœ¨typoraä¸­ç²˜è´´è‡ªåŠ¨ä¸Šä¼ åˆ°å›¾åºŠä½“éªŒç›¸å½“ä¸æ»‘ã€‚","link":"/posts/a3dc8a98.html"},{"title":"python-supperæ–¹æ³•ç”¨æ³•-åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•","text":"python-supperæ–¹æ³•ç”¨æ³•-åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³• Pythonä¸­ä½¿ç”¨superæ–¹æ³•å®ç°åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•åœ¨pythonä¸­æ–°åˆ›å»ºçš„å­ç±»ä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒæ—¶å­ç±»ä¸­é‡å†™æŸä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è¦†ç›–çˆ¶ç±»åŸæœ‰çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šåœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰__init__æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­çš„__init__æ–¹æ³•å°†ä¼šè¦†ç›–æ‰ä»çˆ¶ç±»ç»§æ‰¿çš„__init__.ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š 12345678910111213141516171819class Person(): def __init__(self,name,age): self.name = name self.age = age print(&quot;{} is {} years old.&quot;.format(self.name,self.age))class Student(Person): def __init__(self,name,age,school): self.name = name self.age = age self.school = school print(&quot;{} is {} years old and comes from {} university.&quot;.format(name,age,school))if __name__ == '__main__': p = Person('DaMing',28) s = Student('XiaoMing',18,'bbb') è¿è¡Œç»“æœæ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°åœ¨Studentè¿™ä¸ªç±»ä¸­__init__å·²ç»è¦†ç›–äº†å®ƒçš„çˆ¶ç±»ä¸­çš„__init__æ–¹æ³•ã€‚ 12DaMing is 28 years old.XiaoMing is 18 years old and comes from bbb university. superæ–¹æ³•çš„ä½¿ç”¨é‚£å¦‚æœæƒ³è¦åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»ä¸­çš„åˆå§‹æ–¹æ³•åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ç›´æ¥æƒ³åˆ°çš„è§£å†³æ–¹æ³•å°±æ˜¯æˆ‘ç›´æ¥åœ¨å­ç±»ä¸­ç”¨çˆ¶ç±»çš„åç§°å»è°ƒç”¨å®ƒçš„æ–¹æ³•ä¸å°±å¥½äº†ï¼Œæ¯”å¦‚è¯´åœ¨Studentç±»ä¸­ç›´æ¥å†™Person.__init__()ï¼Œè¿™æ ·åšçš„ç¡®å¯è¡Œä½†æ˜¯å¦‚æœå“ªå¤©ä¿®æ”¹äº†çˆ¶ç±»çš„åç§°é‚£å­ç±»ä¸­å¯¹åº”çš„ä¹Ÿéœ€è¦åšç›¸åº”çš„ä¿®æ”¹ä¸ä¾¿äºä»£ç çš„ç»´æŠ¤ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±è¦ç”¨åˆ°supper()è¿™ä¸ªæ–¹æ³•äº†ã€‚æˆ‘ä»¬æ”¹å†™ä¸€ä¸‹Studentè¿™ä¸ªç±»ã€‚ 12345class Student(Person): def __init__(self,name,age,school): super().__init__(name,age) self.school = school print(&quot;{} is {} years old and comes from {} ä¸Šé¢çš„ç¬¬3è¡Œä»£ç super().__init__(name,age)å®é™…ä¸Šåšäº†è¿™æ ·å‡ ä»¶äº‹æƒ…ã€‚ é€šè¿‡super()æ–¹æ³•è·å–äº†çˆ¶ç±»personçš„å®šä¹‰ã€‚ å­ç±»ä¸­çš„__init__è°ƒç”¨äº†Person.__init__()æ–¹æ³•ã€‚å®ƒä¼šè‡ªåŠ¨çš„å°†selfå‚æ•°ä¼ é€’ç»™çˆ¶ç±»ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æŒ‡å®šå‚æ•°super(cls,inst),clsä¸ºç±»ï¼Œinstä¸ºç±»å®ä¾‹ï¼Œç„¶åä¼ å…¥å…¶ä½™å‚æ•°å³å¯ã€‚","link":"/posts/eb623950.html"},{"title":"Pythonå¤šçº¿ç¨‹ä¸‹å•ä¾‹æ¨¡å¼å®ç°","text":"å•ä¾‹æ¨¡å¼ç®—æ˜¯åœ¨pythonç”¨çš„æ¯”è¾ƒå¤šçš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”è¾ƒå…¸å‹çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šåº”ç”¨é…ç½®ã€æ—¥å¿—æ–‡ä»¶ã€æ•°æ®åº“è°ƒç”¨â€¦å…¶ç‰¹ç‚¹æ˜¯åœ¨æ•´ä¸ªç³»ç»Ÿå‘¨æœŸä»…ä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå› æ­¤å¯ä»¥å‡å°‘å†…å­˜å ç”¨ç©ºé—´ä»¥åŠé¿å…å¤šæ¬¡å®ä¾‹åŒ–ã€‚æ¯”å¦‚ç±»AppConfigä¼šåœ¨æ•´ä¸ªç³»ç»Ÿå¤šæ¬¡è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœæ¯æ¬¡è°ƒç”¨éƒ½è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ— ç–‘ä¼šæ‹–æ…¢ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€‚ å…³äºå•ä¾‹æ¨¡å¼å®ç°ï¼Œ ç½‘ä¸Šæœ‰å¾ˆå¤šèŠ±é‡Œèƒ¡å“¨çš„æ–¹æ³•ï¼Œè¿™é‡Œä»‹ç»ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹æ³•ã€‚ä½¿ç”¨__new__æ–¹æ³•å®ç°ã€‚ åŸºæœ¬åŸç†pythonä¸­å®ä¾‹åŒ–ä¸€ä¸ªç±»æ—¶ä¼šåœ¨è°ƒç”¨__init__æ–¹æ³•å‰è°ƒç”¨__new__æ–¹æ³•ï¼Œå…¶æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æœ¬èº«ï¼Œå…¶ä½™å‚æ•°å’Œ__init__æ–¹æ³•ä¿æŒä¸€è‡´ã€‚å› æ­¤å¯ä»¥åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª_instantceå˜é‡ï¼Œåœ¨ç¬¬ä¸€ä¸ªè¿›è¡Œç¤ºä¾‹åŒ–åå°†å®ä¾‹åŒ–çš„ç±»ä¿å­˜åˆ°_instanceä¸­ï¼Œä¹‹åå®ä¾‹åŒ–æ—¶åªéœ€åˆ¤å®š_instanceå˜é‡æ˜¯å¦ä¸ºç©ºå³å¯ã€‚ ä»¥å®ç°ä¸€ä¸ªå…¨å±€è®¡æ•°å™¨ç±»ä¸ºä¾‹ä¸€ä¸ªæœ€ç®€å•çš„ç‰ˆæœ¬ï¼Œè¿™ç§å®ç°æ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨__init__å‡½æ•°ï¼Œå¹¶ä¸”å­˜åœ¨å¤šçº¿ç¨‹é‡å¤å®ä¾‹åŒ–é—®é¢˜ã€‚ 123456789101112131415161718192021222324252627282930# -*- coding: utf-8 -*-class GlobalCount(object): # ç”¨æ¥ä¿å­˜å®ä¾‹åŒ–åçš„ç±»å®ä¾‹ _instance = None def __new__(cls, *args, **kwargs): if cls._instance: print(&quot;è·³è¿‡å®ä¾‹åŒ–&quot;) return cls._instance else: cls._instance = super(GlobalCount, cls).__new__(cls) return cls._instance def __init__(self): self._count = 0 @property def count(self): return self._count @count.setter def count(self, value): self._count = valueif __name__ == &quot;__main__&quot;: for i in range(10): gc = GlobalCount() gc.count = gc.count + 1 print(gc.count) è¿è¡Œè¿™æ®µä»£ç ç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718191è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1è·³è¿‡å®ä¾‹åŒ–1 å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶é¿å…äº†é‡å¤å®ä¾‹åŒ–çš„é—®é¢˜ï¼Œä½†å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ é¿å…å¤šæ¬¡è°ƒç”¨__init__å‡½æ•°åªéœ€è¦åœ¨æ·»åŠ ä¸€ä¸ªç±»å˜é‡:_init_flagä½œä¸ºæ ‡å¿—ä½å³å¯ã€‚åœ¨__init__æ–¹æ³•å†…éƒ¨å°†åˆå§‹åŒ–ç›¸å…³çš„ä»£ç ç§»åŠ¨åˆ°ifè¯­å¥å†…ï¼Œå¹¶åœ¨å®Œæˆåå°†_init_flagè®¾ä¸ºFalseå³å¯ã€‚ 123456789101112class GlobalCount(object): # ç”¨æ¥ä¿å­˜å®ä¾‹åŒ–åçš„ç±»å®ä¾‹ _instance = None _init_flag = True def __new__(cls, *args, **kwargs): if cls._instance: print(&quot;è·³è¿‡å®ä¾‹åŒ–&quot;) return cls._instance else: cls._instance = super(GlobalCount, cls).__new__(cls) return cls._instance... ä¿è¯å¤šçº¿ç¨‹å®‰å…¨ç»§ç»­å®Œå–„GlobalCountç±»ï¼Œç›®å‰åœ¨å•çº¿ç¨‹ä¸‹å·²ç»å¯ä»¥å®Œç¾çš„å·¥ä½œäº†ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸‹æœ‰å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå®ä¾‹åŒ–ã€‚å¯ä»¥ä½¿ç”¨threadingåŒ…ä¸­çš„lockæ–¹æ³•è¿›è¡ŒåŠ é”å¤„ç†ã€‚ 123456789101112131415import threadingclass GlobalCount(object): # ç”¨æ¥ä¿å­˜å®ä¾‹åŒ–åçš„ç±»å®ä¾‹ _instance = None _init_flag = True _instance_lock = threading.Lock() def __new__(cls, *args, **kwargs): with GlobalCount._instance_lock: if cls._instance: print(&quot;è·³è¿‡å®ä¾‹åŒ–&quot;) return cls._instance else: cls._instance = super(GlobalCount, cls).__new__(cls) return cls._instance æ€»ç»“æ€»ç»“ä¸€ä¸‹ï¼Œä¸ºäº†å®ç°GlobalCountç±»ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†__new__æ–¹æ³•ã€propertyè¯­æ³•ç³–ä»¥åŠthreadingã€‚","link":"/posts/d673f77c.html"},{"title":"pythonçˆ¬å–çŸ¥ä¹æŸä¸ªé—®é¢˜ä¸‹æ‰€æœ‰å›¾ç‰‡","text":"pythonçˆ¬å–çŸ¥ä¹æŸä¸ªé—®é¢˜ä¸‹æ‰€æœ‰å›¾ç‰‡.æ¯”æ–¹è¯´ é’“é±¼è´´ ??? ä¾‹å¦‚è¿™ä¸ªé—®é¢˜ 1. æ€è·¯ åœ¨chormeæµè§ˆå™¨æ§åˆ¶å°è¿‡æ»¤ä¸€ä¸‹answerå…³é”®å­—ï¼Œåœ¨è¿™ä¸ªè¯·æ±‚ä¸­apiæœåŠ¡å™¨è¿”å›äº†ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªå“åº”ä¸­dataå­—æ®µåŒ…å«äº†è¿™ä¸ªé—®é¢˜ä¸‹çš„ä¸‰ä¸ªå›ç­”ï¼Œæ¯ä¸ªå›ç­”ä¸­çš„contentå­—æ®µåŒ…å«äº†è¿™ä¸ªå›ç­”ä¸­æ‰€æœ‰å›¾ç‰‡çš„urlã€‚åŒæ—¶pagingæ ¹æ®å­—æ®µä¸­çš„is_endå’Œis_startå¯ä»¥åˆ¤æ–­å‡ºè¿™æ˜¯å¦æ˜¯æœ€åä¸€é¡µï¼›pagingå­—æ®µä¸­è¿˜æœ‰ä¸‹ä¸€é¡µçš„url. ç°åœ¨é—®é¢˜å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è¯·æ±‚ç¬¬ä¸€é¡µå¹¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å‡ºå›ç­”ä¸­å›¾ç‰‡çš„é“¾æ¥ä¿å­˜ä¸‹æ¥ï¼Œæ¥ç€æ ¹æ®å“åº”ä¸­çš„pagingçš„nextçš„urlä¾æ¬¡è¯·æ±‚ä¸‹å»å³å¯ã€‚ 2. ä»£ç éƒ¨åˆ†main.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129# -*- coding: utf-8 -*-import jsonimport reimport grequestsimport threadingimport osimport click# import sys# sys.setrecursionlimit(1000000) # ä¾‹å¦‚è¿™é‡Œè®¾ç½®ä¸ºä¸€ç™¾ä¸‡BASE_URL = &quot;https://www.zhihu.com/api/v4/questions/{}/answers?include=data%5B*%5D.is_normal%2Cadmin_closed_comment%2Creward_info%2Cis_collapsed%2Cannotation_action%2Cannotation_detail%2Ccollapse_reason%2Cis_sticky%2Ccollapsed_by%2Csuggest_edit%2Ccomment_count%2Ccan_comment%2Ccontent%2Ceditable_content%2Cvoteup_count%2Creshipment_settings%2Ccomment_permission%2Ccreated_time%2Cupdated_time%2Creview_info%2Crelevant_info%2Cquestion%2Cexcerpt%2Crelationship.is_authorized%2Cis_author%2Cvoting%2Cis_thanked%2Cis_nothelp%2Cis_labeled%2Cis_recognized%2Cpaid_info%2Cpaid_info_content%3Bdata%5B*%5D.mark_infos%5B*%5D.url%3Bdata%5B*%5D.author.follower_count%2Cbadge%5B*%5D.topics&amp;limit={}&quot;IMG_BASE_URL = &quot;https://pic3.zhimg.com{}&quot;class ZhSpider(object): def __init__(self, question_id, min_voted_num): &quot;&quot;&quot; :param question_id: é—®é¢˜IDï¼Œåˆ—è¡¨å½¢å¼ :param min_voted_num: å°†ä¼šè¿‡æ»¤æ‰ç‚¹èµæ•°å°äºè¿™ä¸ªå€¼å¾—å›ç­” &quot;&quot;&quot; self.min_voted_num = min_voted_num self.question_url = BASE_URL.format(question_id, 3) self.headers = {&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1.6) &quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;, &quot;Accept-Language&quot;: &quot;en-us&quot;, &quot;Connection&quot;: &quot;keep-alive&quot;, &quot;Accept-Charset&quot;: &quot;GB2312,utf-8;q=0.7,*;q=0.7&quot;} def start(self): &quot;&quot;&quot; å¯åŠ¨çˆ¬è™« &quot;&quot;&quot; # åˆ›å»ºimagesç›®å½• if not os.path.exists('images'): os.mkdir('images') print(&quot;å·²åˆ›å»ºç›®å½• 'images', æ‰€æœ‰çš„å›¾ç‰‡å°†ä¼šä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹&quot;) print('start') response = self.get(self.question_url) next_page_answer_url = self.parse(response) while next_page_answer_url is not None: response = self.get(next_page_answer_url) next_page_answer_url = self.parse(response) print(&quot;Done!&quot;) def get(self, url): &quot;&quot;&quot; å‘é€getè¯·æ±‚ï¼Œè¿”å›è¯·æ±‚å“åº” &quot;&quot;&quot; rs = set([grequests.get(url, headers=self.headers)]) response = grequests.map(rs)[0] return response def parse(self, response): print(&quot;å¼€å§‹æ–°çš„ä¸€é¡µ&quot;) print(&quot;å¼€å§‹å¤„ç†å“åº”...&quot;) dic = json.loads(response.text) # æ­¤ç›¸åº”ä¸­çš„å›ç­”,è¿‡æ»¤æ‰ç‚¹èµæ•°å°äº800çš„å›ç­” answers_list = [ answer for answer in dic.get('data') if answer.get('voteup_count') &gt; self.min_voted_num ] if len(answers_list) is not 0: # çŸ¥ä¹çš„å›ç­”æ˜¯æŒ‰ç…§ç‚¹èµæ•°æ¥æ’åºçš„ï¼Œç‚¹èµæ•°é«˜çš„æ’åœ¨å‰é¢ã€‚æ‰€æœ‰åªè¦çˆ¬åˆ°ç‚¹èµæ•°éƒ½ä¸å¤§äºæŒ‡å®šå€¼çš„ç¬¬ä¸€é¡µå°±å¯ä»¥åœä¸‹æ¥äº†ã€‚ for answer in answers_list: answer_html_content = answer.get('content') # æ­£åˆ™é€‰å‡ºå›ç­”ä¸­çš„img url incomplete_urls = re.findall( r'https:\\/\\/[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%&amp;/~\\+#])?', answer_html_content) # ä½¿ç”¨é›†åˆå»é™¤é‡å¤å›¾ç‰‡ tmp_img_urls = set([later_url for _, later_url in incomplete_urls]) # è¿‡æ»¤é«˜æ¸…å¤§å›¾ img_urls = [] for img_url in tmp_img_urls: if img_url[-5] == 'r': img_urls.append(IMG_BASE_URL.format(img_url)) print(&quot;å¼€å§‹ä¸‹è½½å›¾ç‰‡:{}å¼ .&quot;.format(len(img_urls))) rs = (grequests.get(u, headers=self.headers, timeout=5) for u in img_urls) res = grequests.map(rs) # è¿‡æ»¤æ‰404å“åº” res = [i for i in res if i.status_code == 200] print(&quot;å¼€å§‹ä¿å­˜å›¾ç‰‡: {}å¼ .&quot;.format(len(res))) self.save_imgs(res) # å¢åŠ ä¸€ä¸ªçº¿ç¨‹ä¿å­˜å›¾ç‰‡ # save_img_t = threading.Thread(target=self.save_imgs, args=(res,)) # print(&quot;å¼€å§‹ä¿å­˜å›¾ç‰‡: {}å¼ &quot;.format(len(res))) # save_img_t.start() else: # ç»ˆæ­¢çˆ¬è™« return None if not dic.get('paging').get('is_end'): next_url = dic.get('paging').get('next') return next_url else: return None def save_imgs(self, data): &quot;&quot;&quot; :return: &quot;&quot;&quot; for i in data: with open('images/' + i.request.url[-18:], 'wb') as f: f.write(i.content) print(&quot;æˆåŠŸä¿å­˜å›¾ç‰‡ï¼š{}å¼ .&quot;.format(len(data)))@click.command()@click.option('--question', default=&quot;296631231&quot;, help=&quot;é—®é¢˜id&quot;, type=str)@click.option('--votenum', default=800, help=&quot;æœ€å°ç‚¹èµæ•°,å°†ä¼šè¿‡æ»¤æ‰ç‚¹èµæ•°å°äºè¯¥å€¼å¾—å›ç­”&quot;, type=int)def start(question, votenum): &quot;&quot;&quot; :param answers: :param votenum: :return: &quot;&quot;&quot; # print(question, votenum) zh_spider = ZhSpider(question, votenum) zh_spider.start()if __name__ == &quot;__main__&quot;: start() 4.å±•ç¤ºä¸€ä¸‹ç»“æœ 5.æœ€åä»£ç å·²ä¸Šä¼ è‡³github","link":"/posts/4fcb5fd7.html"},{"title":"scrapyçˆ¬è™«è‹å®æ˜“è´­å›¾ä¹¦ä¿¡æ¯","text":"åœ¨åˆšåˆšå…¥é—¨scrapyåå°è¯•å†™äº†ä¸€ä¸ªå°çš„çˆ¬è™«ï¼Œç›®æ ‡æ˜¯çˆ¬å–è‹å®æ˜“è´­ä¸‹çš„æ‰€æœ‰çš„å›¾ä¹¦ä¿¡æ¯. å°±æ˜¯ä¸‹é¢çš„æ¯ä¸ªå¤§åˆ†ç±»ä¸‹çš„æ‰€æœ‰å°åˆ†ç±»çš„æ‰€æœ‰æ‰€å”®å›¾ä¹¦ä¿¡æ¯ã€‚æˆ‘æ‰€æŠ“å–çš„æ•°æ®æœ‰æ¯ä¸ªå›¾ä¹¦æ‰€åœ¨çš„å¤§åˆ†ç±»ã€å°åˆ†ç±»ã€ä½œè€…ã€å‡ºç‰ˆç¤¾ã€ä»·æ ¼ï¼ˆè¿™ä¸ªæ•°æ®çš„è·å–ç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼‰ã€‚ ç¬¬ä¸€æ­¥ï¼š åˆ†æç½‘é¡µé¦–å…ˆéœ€è¦æ‰¾åˆ°æˆ‘ä»¬è¦çˆ¬å–çš„æ•°æ®çš„ä½ç½®ã€‚ä»¥åŠåˆ†ææ€ä¹ˆåœ¨pythonä¸­æå–æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚ 1.1 æ‰¾åˆ°è¦çˆ¬å–çš„æ•°æ®ä½ç½®åˆ†ç±»ä¿¡æ¯ æ‰“å¼€è°·æ­Œæµè§ˆå™¨è¿›å…¥https://book.suning.com/æŒ‰F12è¿›å…¥æ§åˆ¶å°ï¼Œè¿›å…¥networké€‰é¡¹åï¼Œåˆ·æ–°ä¸€ä¸‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚è·å–çš„å“åº”ä¸­å·²ç»æ˜¯åŒ…å«äº†æ‰€æœ‰åˆ†ç±»çš„urlåœ°å€äº†ã€‚æ‰€ä»¥å¯ä»¥æŠŠæ­¤urlå½“ä½œåˆå§‹urlã€‚ å›¾ä¹¦ä¿¡æ¯ æ¥ä¸‹å¯»æ‰¾å›¾ä¹¦çš„è¯¦ç»†ä¿¡æ¯æ‰€åœ¨çš„ä½ç½®ã€‚éšä¾¿æ‰“å¼€ä¸€ä¸ªå›¾ä¹¦çš„é“¾æ¥ã€‚è¿›å…¥æ§åˆ¶å°æŸ¥çœ‹ç¬¬ä¸€ä¸ªè¯·æ±‚æ‰€è·å¾—çš„å“åº”ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºå¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦è·å–çš„ä¿¡æ¯é™¤äº†ä»·æ ¼å¤–å…¨éƒ½æœ‰äº†ã€‚ ä»·æ ¼ä¿¡æ¯ ç°åœ¨åªå‰©ä¸‹ä¸€ä¸ªä»·æ ¼ä¿¡æ¯äº†ï¼Œåœ¨å›¾ä¹¦çš„è¯¦æƒ…é¡µé¢æ‰“å¼€æ§åˆ¶å°æ‰¾åˆ°nspå¼€å¤´çš„é‚£ä¸ªè¯·æ±‚ï¼Œä»·æ ¼å°±åœ¨è¿™ä¸ªè¯·æ±‚é‡Œé¢ã€‚å¦‚ä¸‹å›¾ã€‚æŸ¥çœ‹è¿™ä¸ªè¯·æ±‚çš„urlåœ°å€å¯ä»¥å‘ç°æœ‰ä¸¤ä¸ªå‚æ•°æ˜¯ä¸ç¡®å®šçš„https://pas.suning.com/nspcsale_0_000000010227414878_000000010227414878_0070183717_120_536_5360101_502282_1000235_9232_11809_Z001___R9011546_1.0___.htmlå…¶ä¸­çš„10227414878ï¼Œ701837171æ˜¯ä¸ç¡®å®šçš„ã€‚è¿™ä¸¤ä¸ªå‚æ•°çš„æ˜¯åœ¨å›¾ä¹¦çš„è¯¦æƒ…é¡µé¢çš„é“¾æ¥ä¸­æ˜¯æœ‰çš„ã€‚ç›´æ¥æ­£åˆ™æå–å°±å¯ä»¥ï¼ˆæ¯”å¦‚è¿™ä¸ªhttps://product.suning.com/0070183717/10227414878.html?srcpoint=pindao_book_27582454_prod01ï¼‰åé¢çš„R9011546æ˜¯å¯ä»¥å»æ‰çš„ã€‚é€šè¿‡å¤šè§‚å¯Ÿå‡ ä¸ªå›¾ä¹¦çš„è¯·æ±‚ä»·æ ¼çš„urlé“¾æ¥å¯ä»¥å‘ç° 1120_536_5360101_502282_1000235_9232_11809_Z001_ æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥æœ€ç»ˆè¯·æ±‚ä»·æ ¼çš„urlåœ°å€https://pas.suning.com/nspcsale_0_{}_{}_{}_120_536_5360101_502282_1000235_9232_11809_Z001_1.0___.html&quot;ã€‚ {}éƒ¨åˆ†åœ¨ä»£ç ä¸­ä¼šç”¨formatå‡½æ•°æ ¼å¼åŒ–ã€‚ # 1.2 åˆ†æå¦‚ä½•è·å–æ•°æ® æ­£åˆ™ or xpath? æ‰¾åˆ°äº†éœ€è¦çš„æ•°æ®æ‰€åœ¨çš„ä½ç½®åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä»ç½‘é¡µä¸­æå–æ•°æ®ã€‚ ## æå–åˆ†ç±»çš„url å¯ä»¥åœ¨è°·æ­Œæµè§ˆå™¨ä¸­ä½¿ç”¨xpath helperå°è¯•ä½¿ç”¨xpathå®šä½åˆ°æ¯ä¸ªå°åˆ†ç±»çš„ä½ç½®ã€‚å¹¶è·å–åˆ†ç±»çš„urlã€‚ç”¨ä»£ç å®ç°å¦‚ä¸‹ï¼š 1234567# è·å–æ¯ä¸ªå¤§åˆ†ç±»ä¸‹çš„æ‰€æœ‰å°åˆ†ç±»å¹¶éå†è·å–æ¯ä¸ªå°åˆ†ç±»å¯¹åº”çš„urlåœ°å€categories_big = response.xpath(&quot;//div[@class='menu-list']/div&quot;) # è¿™é‡Œçš„reponseæ˜¯scrapyé»˜è®¤çš„parseå‡½æ•°é‡Œçš„å‚æ•° for category_big in categories_big: detail_categories = category_big.xpath(&quot;./dl/dd/a&quot;) for detail_category in detail_categories: # å¾—åˆ°å°åˆ†ç±»çš„urlåœ°å€ category_detail_url = detail_category.xpath(&quot;./@href&quot;).extract_first() è·å–å›¾ä¹¦ä¿¡æ¯ è·å–å›¾ä¹¦ä¿¡æ¯è¿™ä¸€æ­¥å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®Œæˆç®€å•ç²—æš´ï¼ï¼ï¼ã€‚ 1234567891011# é¦–å…ˆç”¨xpathçš„è·å–1.1å›¾ä¹¦ä¿¡æ¯å›¾ä¸­çš„metaæ ‡ç­¾çš„å€¼ã€‚ res = response.xpath(&quot;//meta[@property='og:description']/@content&quot;).extract_first() # ä¸‹é¢çš„ä»£ç æ˜¯ç›´æ¥æ­£åˆ™æ‹¿åˆ°æ•°æ®ã€‚ item = {} item['book_name'] = re.findall(r&quot;ã€Š(.*)ã€‹ï¼Œä½œè€…&quot;, res)[0] if len(re.findall(r&quot;ã€Š(.*)ã€‹ï¼Œä½œè€…&quot;, res)) else '' # item['author'] = re.findall(r&quot;ä½œè€…ï¼š(.*)è‘—&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š(.*)è‘—&quot;, res)) else '' item['author'] = re.findall(r&quot;ä½œè€…ï¼š(.*)ï¼Œ.*å‡ºç‰ˆ&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š(.*)ï¼Œ.*å‡ºç‰ˆ&quot;, res)) else '' item['publisher'] = re.findall(r&quot;ä½œè€…ï¼š.*ï¼Œ(.*)å‡ºç‰ˆ&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š.*ï¼Œ(.*)å‡ºç‰ˆ&quot;, res)) else '' item['publisher'] = item['publisher'] + 'å‡ºç‰ˆç¤¾' item['big_category'] = re.findall(r&quot;å“ç±»ï¼š(.*)&gt;&quot;, res)[0] if len(re.findall(r&quot;å“ç±»ï¼š(.*)&gt;&quot;, res)) else '' item['detail_category'] = re.findall(r&quot;&gt;(.*)ï¼Œä»¥åŠ&quot;, res)[0] if len(re.findall(r&quot;&gt;(.*)ï¼Œä»¥åŠ&quot;, res)) else '' ä»·æ ¼ å‰é¢å·²ç»å¾—åˆ°äº†è·å–ä»·æ ¼çš„urlåœ°å€ç›´æ¥è¯·æ±‚å°±å¯ä»¥ï¼Œè¿”å›çš„æ•°æ®æ˜¯ç›´æ¥æ­£åˆ™æ‹¿åˆ°ä»·æ ¼ã€‚è¿™ä¸ªç®€å•å°±ä¸è¯¦ç»†è¯´äº†ã€‚ä¸»è¦æ˜¯è¿™ä¸ªæ•°æ®è¿˜éœ€è¦å¦å¤–è¯·æ±‚ä¸€ä¸ªurlå°±æ¯”è¾ƒéº»çƒ¦ã€‚ã€‚ã€‚ ç¬¬äºŒæ­¥ï¼š å¼€å§‹ç¼–å†™ä»£ç 2.1 æ–°å»ºscrapyé¡¹ç›® è¿™é‡Œæˆ‘å‡è®¾ä½ å·²ç»å®‰è£…å¥½äº†python3å¹¶ä¸”è£…äº†scrapyæ¨¡å—ã€‚å¦‚æœæ²¡æœ‰ï¼Œç™¾åº¦ä¸€ä¸‹ï¼Ÿæ•™ç¨‹å¾ˆå¤šï¼ é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ç›®å½•æ‰“å¼€ç»ˆç«¯ 123scrapy startproject suningcd suningscrapy genspider book suning.com 2.2 é¡¹ç›®ç»“æ„12345678910111213141516171819202122(13-çˆ¬è™«) kanhui@kanhui-Mac ~/D/2/2/1/suning&gt; tree.â”œâ”€â”€ scrapy.cfgâ””â”€â”€ suning â”œâ”€â”€ __init__.py â”œâ”€â”€ __pycache__ â”‚ â”œâ”€â”€ __init__.cpython-37.pyc â”‚ â”œâ”€â”€ items.cpython-37.pyc â”‚ â”œâ”€â”€ pipelines.cpython-37.pyc â”‚ â””â”€â”€ settings.cpython-37.pyc â”œâ”€â”€ items.py â”œâ”€â”€ middlewares.py â”œâ”€â”€ pipelines.py â”œâ”€â”€ settings.py â”œâ”€â”€ setup.py â””â”€â”€ spiders â”œâ”€â”€ __init__.py â”œâ”€â”€ __pycache__ â”‚ â”œâ”€â”€ __init__.cpython-37.pyc â”‚ â””â”€â”€ book.cpython-37.pyc â””â”€â”€ book.py 2.3è¯¦ç»†ä»£ç book.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109#!/usr/bin/env python# -*- coding: utf-8 -*-# ************************************************************************# *# * @file:book.py# * @author:kanhui# * date:2019-09-01 14:01:05# * @version vim 8# *# ************************************************************************import scrapyimport refrom suning.items import SuningItemfrom copy import deepcopyclass BookSpider(scrapy.Spider): name = 'book' allowed_domains = ['suning.com'] start_urls = ['https://book.suning.com/?safp=d488778a.46602.crumbs.2'] def parse(self, response): '''è·å–å›¾ä¹¦åˆ†ç±»åœ°å€ï¼Œè¿›è¡Œåˆ†ç»„''' categories_big = response.xpath(&quot;//div[@class='menu-list']/div&quot;) for category_big in categories_big: detail_categories = category_big.xpath(&quot;./dl/dd/a&quot;) for detail_category in detail_categories: category_detail_url = detail_category.xpath(&quot;./@href&quot;).extract_first() # yieldä¸€ä¸ªrequestå¯¹è±¡ print(&quot;çˆ¬å–åˆ†ç±»&quot;) yield scrapy.Request( category_detail_url, callback=self.parse2 ) print(&quot;ç»“æŸä¸€ä¸ªåˆ†ç±»çš„çˆ¬å»&quot;) def parse2(self, response): # è·å–å½“å‰é¡µé¢çš„æ¯ä¸ªå›¾ä¹¦çš„ä¿¡æ¯ results = response.xpath(&quot;//div[@class='res-info']&quot;) for res in results: item = {} book_detail_url = res.xpath(&quot;./p[@class='sell-point']/a/@href&quot;).extract_first() ids = re.findall(r&quot;com/(.*)/(.*).html&quot;, book_detail_url) if len(ids): item['shop_id'], item['prdid'] = ids[0] else: item['shop_id'] = item['prdid'] = '' # yieldä¸€ä¸ªrequestå¯¹è±¡ yield scrapy.Request( 'https:' + book_detail_url, callback=self.parse3, meta=item ) self.base_url = &quot;https://list.suning.com/{}-{}.html&quot; # cur_url = response.xpath(&quot;//a[@class='']/@href&quot;).extract_first() cur_url = response.url # å½“å‰çš„é¡µç æ•°æ°å¥½å’Œä¸‹ä¸€é¡µçš„urlåœ°å€ä¸­çš„ä¹Ÿç æ•°ç›¸åŒã€‚ prefix, cur_page = re.findall(r&quot;com/(.*)-(.*).html&quot;, cur_url)[0] if int(cur_page) &lt; 100: next_url = self.base_url.format(prefix, str(int(cur_page) + 1)) print(&quot;çˆ¬å–{}é¡µã€‚\\n&quot;.format(str(cur_page))) yield scrapy.Request( next_url, callback=self.parse2 ) def parse3(self, response): '''ä¹¦ç±è¯¦æƒ…é¡µé¢''' res = response.xpath(&quot;//meta[@property='og:description']/@content&quot;).extract_first() item = {} item['book_name'] = re.findall(r&quot;ã€Š(.*)ã€‹ï¼Œä½œè€…&quot;, res)[0] if len(re.findall(r&quot;ã€Š(.*)ã€‹ï¼Œä½œè€…&quot;, res)) else '' # item['author'] = re.findall(r&quot;ä½œè€…ï¼š(.*)è‘—&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š(.*)è‘—&quot;, res)) else '' item['author'] = re.findall(r&quot;ä½œè€…ï¼š(.*)ï¼Œ.*å‡ºç‰ˆ&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š(.*)ï¼Œ.*å‡ºç‰ˆ&quot;, res)) else '' item['publisher'] = re.findall(r&quot;ä½œè€…ï¼š.*ï¼Œ(.*)å‡ºç‰ˆ&quot;, res)[0] if len(re.findall(r&quot;ä½œè€…ï¼š.*ï¼Œ(.*)å‡ºç‰ˆ&quot;, res)) else '' item['publisher'] = item['publisher'] + 'å‡ºç‰ˆç¤¾' item['big_category'] = re.findall(r&quot;å“ç±»ï¼š(.*)&gt;&quot;, res)[0] if len(re.findall(r&quot;å“ç±»ï¼š(.*)&gt;&quot;, res)) else '' item['detail_category'] = re.findall(r&quot;&gt;(.*)ï¼Œä»¥åŠ&quot;, res)[0] if len(re.findall(r&quot;&gt;(.*)ï¼Œä»¥åŠ&quot;, res)) else '' ids = response.meta shop_id = ids.get('shop_id') prdid = ids.get('prdid') prdid = &quot;0&quot; * (18 - len(prdid)) + prdid url = &quot;https://pas.suning.com/nspcsale_0_{}_{}_{}_120_536_5360101_502282_1000235_9232_11809_Z001_1.0___.html&quot;.format( prdid, prdid, shop_id) yield scrapy.Request( url, self.get_price, meta=deepcopy(item) ) def get_price(self, response): item = response.meta price = re.findall(r'&quot;promotionPrice&quot;:&quot;(.*)&quot;,&quot;bookPrice&quot;', response.text)[0] if len( re.findall(r'&quot;promotionPrice&quot;:&quot;(.*)&quot;,&quot;bookPrice&quot;', response.text)) else 0 item['price'] = float(price) book_item = SuningItem() book_item['book_name'] = item.get('book_name') book_item['author'] = item.get('author') book_item['publisher'] = item.get('publisher') book_item['big_category'] = item.get('big_category') book_item['detail_category'] = item.get('detail_category') book_item['price'] = item.get('price') yield book_item item.py 12345678910#!/usr/bin/env pythonclass SuningItem(scrapy.Item): # define the fields for your item here like: # name = scrapy.Field() big_category = scrapy.Field() detail_category = scrapy.Field() book_name = scrapy.Field() price = scrapy.Field() publisher = scrapy.Field() author = scrapy.Field() piplines.py 123456789101112from pymongo import MongoClientclient = MongoClient()collections = client['suning']['book1']class SuningPipeline(object): def process_item(self, item, spider): collections.insert(dict(item)) print(str(item)) return item æ³¨æ„ï¼šéœ€è¦å¯åŠ¨mongodbåæ‰å¯ä»¥å­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“ã€‚å¦å¤–åªä¿®æ”¹äº†è¿™ä¸‰ä¸ªæ–‡ä»¶å…¶ä½™æ–‡ä»¶å‡æœªä¿®æ”¹ã€‚æœ€å ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼Œæˆ‘è¿è¡Œäº†å¤§æ¦‚30åˆ†é’ŸæŠ“åˆ°äº†30000å¤šæ¡æ•°æ®ã€‚","link":"/posts/46548bc2.html"},{"title":"ä½¿ç”¨flask-httpauthç»™ä½ çš„flask-restful-apiåŠ å…¥è¯·æ±‚è®¤è¯","text":"æœ€è¿‘åœ¨ç”¨vue.jså’Œflask-restfulå¼€å‘ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„ä¸ªäººåšå®¢ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ¥å£articleç”¨äºæ ¹æ®æ–‡ç« IDå¯¹æ–‡ç« è¿›è¡ŒæŸ¥è¯¢(getè¯·æ±‚)ã€ä¿®æ”¹(postè¯·æ±‚)ç­‰æ“ä½œã€‚æ˜¾ç„¶è¿™ä¸ªæ¥å£åªæœ‰æŸ¥è¯¢æ“ä½œèƒ½å¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾è€Œä¿®æ”¹æ“ä½œåªå¯¹ç®¡ç†å‘˜å¼€æ”¾ã€‚è¿™æ—¶å€™å°±éœ€è¦å¯¹aritcleæ¥å£è¿›è¡Œè¯·æ±‚è®¤è¯ï¼Œç”±äºRestful apiå¹¶ä¸ä¿å­˜çŠ¶æ€ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•ä½¿ç”¨Flask-loginä¾èµ–Cookieä»¥åŠsessionæ¥å®ç°è®¤è¯ã€‚æ‰€æœ‰è¿™é‡Œæˆ‘ä½¿ç”¨äº†å¦ä¸€ä¸ªæ‰©å±•Flask-HTTPAuth 1. é‡å†™å‰çš„æ¥å£å…ˆæ¥çœ‹ä¸€ä¸‹é‡å†™å‰çš„æ¥å£ä¸‹é¢æ˜¯ä¸€ä¸ªdemoã€‚articleæ¥å£æ”¯æŒgetã€postè¯·æ±‚ï¼Œåˆ†åˆ«ç”¨äºæŸ¥è¯¢æ–‡ç« ä¿¡æ¯å’Œä¿®æ”¹æ–‡ç« ä¿¡æ¯ï¼Œ ç”¨åˆ—è¡¨æ¥å­˜å‚¨æ–‡ç« æ•°æ®ä½¿ç”¨åˆ—è¡¨åµŒå¥—å­—å…¸çš„å½¢å¼ï¼Œå­˜å‚¨ä¸¤ä¸ªæ–‡ç« ï¼Œæ¯ä¸ªæ–‡ç« åŒ…å«äº†ä¸¤ä¸ªå­—æ®µidç”¨äºæŸ¥è¯¢æ–‡ç« å’Œcontentå­˜å‚¨æ–‡ç« çš„å†…å®¹ã€‚ 1234567891011from flask_restful import reqparse, Resourcearticles = [ { 'id': 1, 'content': &quot;test article 1&quot; }, { 'id': 2, 'content': &quot;test article 2&quot; }] ä½¿ç”¨flask-restfulç¼–å†™articleæ¥å£ä½¿ç”¨flask-restfulç¼–å†™articleæ¥å£ï¼Œæ¥å—ä¸¤ç§è¯·æ±‚getå’Œpost,åˆ†åˆ«ç”¨äºæŸ¥è¯¢æ–‡ç« å’Œä¿®æ”¹æ–‡ç«  1234567891011121314151617181920212223242526272829class Article(Resource): def __init__(self): self.parser = reqparse.RequestParser() self.parser.add_argument('id', type=int) self.parser.add_argument('content', type=str) def get(self): # ä»getè¯·æ±‚ä¸­è·å–æ–‡ç« idå€¼ article_id = self.parser.parse_args().get('id') # æ ¹æ®idä»åˆ—è¡¨ä¸­æŸ¥æ‰¾æ–‡ç«  for article in articles: if article.get('id') is article_id: # è¿”å›æŸ¥æ‰¾åˆ°çš„æ•°æ® return article, 200 def post(self): # img_file = self.parser.parse_args().get('imgFile') # img_file.save(img_file.filename) # ä»è¯·æ±‚ä¸­è·å–contentå€¼å’Œidå€¼ article_id = self.parser.parse_args().get('id') content = self.parser.parse_args().get('content') # æŸ¥æ‰¾æ–‡ç«  for article in articles: if article.get('id') is article_id: res = article # ä¿®æ”¹æ–‡ç«  res['content'] = content return res, 201 2. ä½¿ç”¨flask-httpauthæ·»åŠ è¯·æ±‚è®¤è¯æˆ‘ä»¬ä¸å¸Œæœ›articleè¿™ä¸ªæ¥å£çš„postè¯·æ±‚å¯¹ä»»ä½•äººéƒ½å¼€æ”¾ã€‚é€šè¿‡å¼•å…¥flask-httpauthå¯¹articleæ¥å£çš„postè¯·æ±‚åŠ å…¥è¯·æ±‚è®¤è¯ã€‚Flask-HTTPAuthæ˜¯ä¸€ä¸ªç®€å•çš„æ‰©å±•ï¼Œå®ƒç®€åŒ–äº†HTTPèº«ä»½éªŒè¯ä¸Flaskè·¯ç”±çš„ä½¿ç”¨ã€‚å…¶æä¾›äº†å¤šç§ä¸åŒçš„Authæ–¹æ³•ï¼Œæ¯”å¦‚HTTPBasicAuthï¼ŒHTTPTokenAuthï¼ŒMultiAuthå’ŒHTTPDigestAuthã€‚è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨åŸºæœ¬çš„å¯†ç éªŒè¯ï¼ŒåŒæ—¶ 2.1 å®‰è£…flask-httpauthåœ¨ä½ çš„ç»ˆç«¯çª—å£æ‰§è¡Œ: 1pip install Flask-HTTPAuth åˆ›å»ºflask-httpauthå¯¹è±¡å®è±¡ã€‚éœ€è¦æ³¨æ„ï¼Œåˆå§‹åŒ–å®ä¾‹æ—¶ä¸éœ€è¦ä¼ å…¥appå¯¹è±¡ï¼Œä¹Ÿä¸éœ€è¦è°ƒç”¨auth.init_app(app)æ³¨å…¥åº”ç”¨å¯¹è±¡ã€‚ 123from flask import Flaskfrom flask_httpauth import HTTPBasicAuth 2.2 ä½¿ç”¨HTTPBasicAuthä½¿ç”¨æˆ‘ä»¬å…ˆç®€å•çš„ä½¿ç”¨HTTPBasicAuthè¿›è¡Œç”¨æˆ·å’Œå¯†ç è®¤è¯ã€‚åˆ›å»ºHTTPBasicAuthå®ä¾‹å¯¹è±¡ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·åå’Œå¯†ç å­˜å…¥ä¸€ä¸ªå­—å…¸é‡Œé¢ã€‚ 123456auth_basic = HTTPBasicAuth()# å•ç”¨æˆ·user = { 'username':&quot;amdin&quot;, 'password':'123456'} 2.2.1 å¯¹article æ¥å£æ·»åŠ è¯·æ±‚è®¤è¯@auth_basic.login_requiredè£…é¥°å™¨è¡¨ç¤ºè§†å›¾éœ€è¦è®¤è¯ï¼Œåœ¨flask-restfulç¼–å†™çš„apiä¸­æˆ‘ä»¬éœ€è¦çš„åœ¨æ¥å£ä¸­æ·»åŠ ç±»å˜é‡method_decoratorsã€‚å…¶å€¼æ˜¯ä¸€ä¸ªå­—å…¸å½¢å¼ã€‚ä¸‹é¢çš„ä»£ç è¡¨ç¤ºArticleæ¥å£çš„postå’Œdeleteè¯·æ±‚éœ€è¦è®¤è¯ã€‚ 12345class Article(Resource): method_decorators = { 'post': [auth_basic.login_required], 'delete': [auth_basic.login_required] } 2.2.2 ç¼–å†™éªŒè¯ç”¨æˆ·å¯†ç çš„å›è°ƒå‡½æ•°@auth_basic.verify_passwordè£…é¥°å™¨ç”¨äºéªŒè¯ç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨å®ƒæ‰€ä¿®é¥°çš„å‡½æ•°é‡Œé¢è¿”å›Trueæˆ–è€…æ˜¯False. 123@auth_basic.verify_passworddef verify_password(username,password): return user['username'] == username and user['password'] == password 2.2.3 å¯¹æ¥å£è¿›è¡Œæµ‹è¯•ä½¿ç”¨curlå‘½ä»¤å¯¹æ¥å£è¿›è¡Œæµ‹è¯•, ä¼šå¾—åˆ°Unauthorized Accessè¡¨ç¤ºæ²¡æœ‰æƒé™ã€‚ 1curl -d &quot;id=1&amp;content=modify article1&quot; -X POST http://127.0.0.1:5000/article åŠ å…¥ç”¨æˆ·åå’Œå¯†ç ååˆ™å¯ä»¥æ­£å¸¸ä¿®æ”¹æ–‡ç« ã€‚ 1curl -u admin:123456 -d &quot;id=1&amp;content=modify article1&quot; -X POST http://127.0.0.1:5000/article 2.2.4 é”™è¯¯å¤„ç†åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæœªè®¤è¯æˆåŠŸï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›401çŠ¶æ€ç åŠâ€Unauthorized Accessâ€æ–‡æœ¬ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡é‡å†™é”™è¯¯å¤„ç†æ–¹æ³•ï¼Œè‡ªå®šä¹‰è¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚ç”¨@auth_basic.error_handlerè£…é¥°å™¨æ¥ä¿®é¥°é”™è¯¯å¤„ç†æ–¹æ³•ï¼š 1234from flask import make_response, jsonify@auth_basic.error_handlerdef auth_basic_unauthorized(): return make_response(jsonify({'res': 0, 'message': 'Unauthorized access'}), 401) åŠ å…¥è¿™ä¸ªé”™è¯¯å¤„ç†æ–¹æ³•åï¼Œè®¤è¯å¤±è´¥åæœåŠ¡å™¨ä¼šè¿”å›JSONä¿¡æ¯{res:0,message:Unauthorized access}. 2.2.5 ä½¿ç”¨Flask-Bcryptåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•°æ®åº“ä¸­çš„å¯†ç æ˜¯ä»¥éæ˜æ–‡çš„å½¢å¼å­˜å‚¨çš„ã€‚å¯ä»¥ä½¿ç”¨Flask-Bcryptæ‰©å±•å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œåå†å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚å®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œã€‚ 2.3 ä½¿ç”¨ HTTPTokenAuthå¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸æ˜¯ä½¿ç”¨å¯†ç å’Œç”¨æˆ·åè¿›è¡ŒéªŒè¯çš„ï¼Œè€Œæ˜¯ä½¿ç”¨tokenæ¥åšéªŒè¯ã€‚Flask-HTTPAuthä¸­çš„HTTPTokenAuthå¯ä»¥å®ŒæˆtokenéªŒè¯ã€‚ä¸HTTPBasicAuthç›¸ä¼¼ï¼Œå®ƒä¹Ÿæä¾›äº†login_requiredè£…é¥°å™¨æ¥è®¤è¯è§†å›¾å‡½æ•°ï¼Œerror_handlerè£…é¥°å™¨æ¥å¤„ç†é”™è¯¯ã€‚ä¸åŒçš„æ˜¯å®ƒæ²¡æœ‰verify_passwordè£…é¥°å™¨å–è€Œä»£ä¹‹çš„æ˜¯verify_tokenã€‚åœ¨è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨ä¸€ä¸ªloginæ¥å£ç”¨äºç™»å½•æ“ä½œï¼Œç™»å½•ä¹‹åå°†ä¼šä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç”Ÿæˆä¸€ä¸ªtokenï¼Œå­˜å‚¨åœ¨flaskçš„å…¨å±€å˜é‡gä¸­ï¼Œä»¥ä¾›tokenéªŒè¯æ—¶è°ƒç”¨ã€‚å…·ä½“ä»£ç ç­‰æœ‰æ—¶é—´åœ¨å†™å§ã€‚ã€‚ã€‚ æœªå®Œã€‚ã€‚ã€‚","link":"/posts/1af3d3fa.html"},{"title":"åˆ†äº«Paragon NTFS for Mac æ— é™è¯•ç”¨ç ´è§£ç‰ˆ","text":"å¤§æ¦‚åœ¨2019.å¹´3æœˆä»½çš„æ—¶å€™æˆ‘åˆšç»™ç¬”è®°æœ¬è£…ä¸Šé»‘è‹¹æœæ—¶ï¼Œæˆ‘å¾ˆè‹¦æ¼çš„å‘ç°è¿™ä¸ªMac osåªèƒ½è¯»ntfsæ ¼å¼çš„ç§»åŠ¨ç¡¬ç›˜å´å†™ä¸äº†ğŸŒš. æç¤ºï¼šä¸‹é¢è¿™ä¸ªç‰ˆæœ¬åœ¨æœ¬æœº10.15.3å¯æ­£å¸¸ä½¿ç”¨. Paragon ntfs 15|ntfs for mac ç ´è§£ç‰ˆæ˜¯ä¸€ä¸ªåº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åº,ä¸“é—¨å¼€å‘ç”¨æ¥å¼¥åˆWindowså’ŒMac OS Xä¹‹é—´çš„ä¸å…¼å®¹æ€§ï¼Œé€šè¿‡åœ¨Mac OS Xç³»ç»Ÿä¸‹æä¾›å¯¹ä»»ä½•ç‰ˆæœ¬çš„NTFSæ–‡ä»¶ç³»ç»Ÿå®Œå…¨çš„è¯»å†™è®¿é—®æœåŠ¡æ¥å¼¥åˆè¿™ç§ä¸å…¼å®¹æ€§ã€‚ä¸ºæ‚¨è½»æ¾è§£å†³Macä¸èƒ½è¯†åˆ«Windows NTFSæ–‡ä»¶éš¾é¢˜ï¼Œè®©æ‚¨ç®€å•è‡ªå¦‚è¯»å†™NTFSå¤–ç½®å­˜å‚¨æ–‡ä»¶ã€‚æ‚¨æ— æ³•åœ¨NTFSåˆ†åŒºä¸­åˆ›å»ºã€åˆ é™¤æˆ–è€…ä¿®æ”¹æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œè€Œä»…ä»…åªèƒ½è¯»å–ã€‚é€šè¿‡Paragonçš„ Mac OS Xä¸“ç”¨NTFSï¼Œæ‚¨å¯ä»¥åœ¨Mac OS Xä¸‹å…¨è¯»/å†™è®¿é—®NTFSçš„ä»»ä½•åˆ†åŒºã€‚ 1. ä½¿ç”¨æ–¹æ³•åŒå‡»æ‰“å¼€dmgåŒ…é€‰æ‹©å®‰è£…NTFS for mac.appä¹‹åä¸€è·¯ä¸‹ä¸€æ­¥å³å¯ã€‚ ä¹‹ååœ¨è¿™ä¸€æ­¥é€‰æ‹©10å¤©ä½¿ç”¨ åœ¨10å¤©è¿‡æœŸä¹‹åä½¿ç”¨å®‰è£…åŒ…é‡Œé¢çš„Trial Reset.appé‡ç½®è¯•ç”¨åå°±å¯ä»¥é‡æ–°å¼€å§‹10å¤©è¯•ç”¨äº†. æ£’ğŸ‘ 2. å‡ºç°Macæ–‡ä»¶æŸåå¤„ç†æ–¹æ³•æ‰“å¼€Macç»ˆç«¯ è¾“å…¥ä»¥ä¸‹ä»£ç å›è½¦sudo spctl --master-disable(ç»ˆç«¯æ˜¯Macç³»ç»Ÿçš„ä¸€ä¸ªç³»ç»Ÿè½¯ä»¶,åœ¨å®ç”¨èœå•æ–‡ä»¶å¤¹ä¸­,æ‰¾ä¸åˆ°å°±ç”¨Macç³»ç»Ÿæœç´¢â€ç»ˆç«¯â€ä¸¤ä¸ªå­—)ä¹‹åè¾“å…¥ç”µè„‘å¯†ç æ‰“å¼€æ‰€æœ‰æ¥æºå³å¯è¿è¡Œï¼ æ³¨æ„ï¼šåœ¨ç»ˆç«¯ä¸‹è¾“å…¥å¯†ç ä¸ä¼šæ˜¾ç¤ºï¼Œè¾“å…¥å®Œæˆç›´æ¥å›è½¦å³å¯ï¼Œå¦‚æœè¾“å…¥é”™è¯¯ä¼šç”¨è‹±æ–‡æç¤ºé”™è¯¯è¯·é‡è¯•ï¼Œå†æ¬¡è¾“å…¥æ­£ç¡®çš„å¯†ç å›è½¦å³å¯ï¼› 3. æŸç›˜é“¾æ¥é“¾æ¥:https://pan.baidu.com/s/1gID7Ax-dl_5z76iehVOAGg å¯†ç :arxx å¦‚æœé“¾æ¥å¤±æ•ˆäº†å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºæé†’æˆ‘æ›´æ–°ã€‚","link":"/posts/908a119d.html"},{"title":"æå®æ¯…æœºå™¨å­¦ä¹ logistic-regression","text":"å°å¤§æå®æ¯…æœºå™¨å­¦ä¹ è¯¾ç¨‹ç¬¬äºŒæ¬¡ä½œä¸šï¼Œlogistic regressioné¢„æµ‹æ”¶å…¥ã€‚è¿™æ˜¯æˆ‘å¯¹è¿™ä¸ªä½œä¸šçš„æ€»ç»“ï¼Œæ–¹ä¾¿æ—¥åå¤ä¹ ã€‚ä»£ç å’Œè®­ç»ƒæ•°æ®å·²ä¸Šä¼ è‡³github,æˆ³æˆ‘ çŸ¥è¯†å‡†å¤‡2019.11.24å·è¿™ä¸ªå‘¨æœ«ç”¨äº†ä¸¤å¤©çš„æ—¶é—´ç»ˆäºåšå®Œäº†ï¼ŒæœŸé—´å‚è€ƒçš„å„ç§èµ„æ–™æˆ‘ä¼šåœ¨æ–‡ç« æœ€ååˆ—å‡ºã€‚é‚£å®Œæˆè¿™æ¬¡ä½œä¸šè‡³å°‘éœ€è¦å…·å¤‡ä¸‹é¢çš„çŸ¥è¯†ç‚¹ã€‚ å¾®ç§¯åˆ† æ¢¯åº¦ä¸‹é™åŸç† pandaså’Œnumpyçš„åŸºæœ¬ä½¿ç”¨ ä½œä¸šè¦æ±‚è¯¾ç¨‹æä¾›çš„ä½œä¸šè¦æ±‚æ–‡æ¡£.(å…¶ä¸­çš„kaggleæäº¤åœ°å€å·²å¤±æ•ˆ,æˆ‘åœ¨æ–‡ç« æœ«å°¾æä¾›äº†è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ä¸‹è½½åœ°å€)ã€‚ç»™å®šè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæ ¹æ®è®­ç»ƒé›†å»ºç«‹æ¨¡å‹åˆ¤æ–­æµ‹è¯•é›†ä¸­çš„æ¯ä¸ªidå¯¹åº”çš„æ”¶å…¥æ˜¯å¦è¶…è¿‡50K. æ€è·¯åˆ†æé¦–å…ˆï¼Œå¾ˆæ˜æ˜¾çš„äºŒåˆ†ç±»é—®é¢˜ï¼Œæ ¹æ®åœ¨bç«™(å¯¹ï¼Œå°±æ˜¯bç«™)è¯¾å ‚ä¸Šå­¦åˆ°å†…å®¹é€‰æ‹©ä½¿ç”¨logistic regression(å¯¹æ•°å‡ ç‡å›å½’)æ¥å®ç°.æ•°å€¼ä¼˜åŒ–ä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œå½“ç„¶å…¶ä»–æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ 1. å¼•å…¥å¯¹æ•°å‡ ç‡é¢„æµ‹å‡½æ•°å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šå¹¿ä¹‰çº¿æ€§æ¨¡å‹ã€‚åœ¨è¥¿ç“œä¹¦ä¸Šçš„å®šä¹‰æ˜¯è¿™æ ·çš„è€ƒè™‘å•è°ƒå¯å¾®å‡½æ•°$g(X)$ä»¤ $ y = g(w^Tx +b)$è¿™æ ·å°±å¾—åˆ°äº†â€œå¹¿ä¹‰çº¿æ€§æ¨¡å‹(generalized linear model)â€œå…¶ä¸­å‡½æ•°$g(X)$ç§°ä¸ºâ€è”ç³»å‡½æ•°(link function)â€œ.æ˜¾ç„¶ï¼Œçº¿æ€§å›å½’æ¨¡å‹å°±æ˜¯$g(X) = 1,x \\in R$ ã€‚ ç°åœ¨å›åˆ°é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨çº¿æ€§æ¨¡å‹è§£å†³ä¸€ä¸ªäºŒåˆ†ç±»çš„é—®é¢˜ï¼Œé‚£ä¹ˆåªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå•è°ƒå¯å¾®çš„å‡½æ•°$g(X)$å°†åˆ†ç±»ä»»åŠ¡çš„çœŸå®æ ‡è®°yä¸çº¿æ€§å›å½’æ¨¡å‹çš„é¢„æµ‹å€¼è”ç³»èµ·æ¥å³å¯ã€‚è¿™å¥ä¸ç†è§£æ²¡å…³ç³»ï¼Œæ¥ç€çœ‹ä¸‹ä¸€æ®µå°±æ˜ç™½äº† çº¿æ€§å›å½’æ¨¡å‹ä¸­äº§ç”Ÿçš„é¢„æµ‹å€¼$z = w^Tx + b$è¿™é‡Œçš„$z$æ˜¯ä¸€ä¸ªå®å€¼$z \\in R$ã€‚äºŒåˆ†ç±»é—®é¢˜ä¸­æˆ‘ä»¬æƒ³è¦çš„é¢„æµ‹å€¼$y$æ˜¯ä¸€ä¸ªç¦»æ•£å€¼0æˆ–è€…æ˜¯1ï¼Œå³$y$çš„å€¼æ˜¯æ­£ä¾‹æˆ–è€…åä¾‹ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰¾ä¸€ä¸ªå‡½æ•° $ y = g(z) $ å®ƒçš„è¾“å…¥å€¼ $z$ è¾“å‡ºå€¼æ˜¯ $ y \\in [0,1] $ ã€‚æœ€ç†æƒ³çš„å‡½æ•°æ˜¯â€å•ä½é˜¶è·ƒå‡½æ•°â€œã€‚å¦‚ä¸‹ï¼š $$g(z) = \\begin{cases} 0 &amp; z &lt; 0\\ 0.5&amp;z=0 \\ 1&amp;z&gt;0 \\end{cases} $$ å³è‹¥é¢„æµ‹å€¼$z$å¤§äº0åˆ¤æ–­ä¸ºåˆ†ç±»1ï¼Œå°äº0åˆ™åˆ¤æ–­æˆ‘åˆ†ç±»2ï¼Œé¢„æµ‹å€¼ä¸ºä¸´ç•Œå€¼åˆ™å¯ä»¥ä»»æ„åˆ¤åˆ«ã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°å¦‚ä¸‹å›¾å®ƒå¹¶ä¸è¿ç»­ä¸èƒ½ä½œä¸ºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ä¸­çš„$g(X)$ã€‚äºæ˜¯æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸€å®šç¨‹åº¦ä¸Šç›¸ä¼¼å•ä½é˜¶è·ƒå‡½æ•°åŒæ—¶å•è°ƒå¯å¾®ã€‚å¯¹æ•°å‡ ç‡å‡½æ•°å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š $$g(z) = \\frac{1}{1 + e^{-z}}$$ å¯¹æ•°å‡ ç‡å‡½æ•°ä¸å•ä½é˜¶è·ƒå‡½æ•°å›¾åƒå¦‚ä¸‹ï¼š æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•° ä»£å…¥åˆ°å¹¿ä¹‰çº¿æ€§æ¨¡å‹ä¸­å°±å¾—åˆ°äº†å¯¹æ•°å‡ ç‡å›å½’çš„é¢„æµ‹å‡½æ•° $$y = \\frac{1}{1+e^{-z}} = {1 \\over 1+ e^{-{(w^Tx+b)}}}$$ã€‚ 1.1 è§£é‡Šå¯¹æ•°å‡ ç‡çš„å«ä¹‰ç°åœ¨æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹â€œå¯¹æ•°å‡ ç‡â€è¿™ä¸ªè¯çš„å«ä¹‰ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠ $y = \\frac{1}{1+e^{-z}} $ ä¸­çš„$z$æå–å‡ºæ¥å°±å¾—åˆ°äº† $ln{\\frac{y}{1-y}}=w^Tx+b$ ã€‚å…¶ä¸­å¦‚æœæŠŠyçœ‹ä½œä¸ºæ ·æœ¬æ˜¯æ­£ä¾‹çš„å¯èƒ½æ€§ï¼Œåˆ™$1-y$æ˜¯å…¶åä¾‹çš„å¯èƒ½æ€§ï¼Œè¿™ä¸¤è€…çš„æ¯”å€¼ $ \\frac{y}{1-y} $å°±ç§°ä¸ºå‡ ç‡ï¼Œåæ˜ äº†$x$ä½œä¸ºæ­£ä¾‹çš„å¯èƒ½æ€§ã€‚å¯¹å‡ ç‡å–å¯¹æ•°å¾—åˆ°çš„ $ ln\\frac{y}{1-y} $å°±ç§°ä¸ºå¯¹æ•°å‡ ç‡ã€‚ 2.æ‰¾åˆ°æŸå¤±å‡½æ•°ç°åœ¨å·²ç»çŸ¥é“äº†å¯¹æ•°å‡ ç‡å›å½’çš„é¢„æµ‹å‡½æ•°ï¼Œåªéœ€è¦æ‰¾åˆ°æŸå¤±å‡½æ•°ï¼Œç„¶åç”¨æ¢¯åº¦ä¸‹é™æ³•ç¡®å®šwå’Œbçš„å€¼å°±å®Œæˆä»»åŠ¡äº†ã€‚å¯¹æ•°å‡ ç‡å›å½’ä¸­æŸå¤±å‡½æ•°å¹¶æ˜¯çº¿æ€§å›å½’ä¸­çš„å¹³æ–¹è¯¯å·®æŸå¤±ï¼Œè€Œæ˜¯äº¤å‰ç†µ(å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« );æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹æ•°ä¼¼ç„¶æ¨å¯¼(å¯ä»¥å‚è€ƒä¹¦ç±-æœºå™¨å­¦ä¹ -å‘¨å¿—åç¬¬ä¸‰ç« éƒ¨åˆ†)å‡ºæ¥æŸå¤±å‡½æ•°ç»“æœæ˜¯ä¸€æ ·çš„ã€‚äº¤å‰ç†µè€å¸ˆåœ¨è§†é¢‘é‡Œå·²ç»ç»™å‡ºäº†å…¬å¼ï¼š $$ L(w,b) = -[ylny^* + (1-y)ln(1-y^*)]$$ è¿™ä¸ªæŸå¤±å‡½æ•°é€šå¸¸ç§°ä½œä¸º å¯¹æ•°æŸå¤± (logloss)ï¼Œè¿™é‡Œçš„å¯¹æ•°åº•ä¸ºè‡ªç„¶å¯¹æ•° ï¼Œå…¶ä¸­çœŸå®å€¼ æ˜¯æœ‰ 0/1 ä¸¤ç§æƒ…å†µï¼Œè€Œæ¨æµ‹å€¼$ y^* $ ç”±äºå€ŸåŠ©å¯¹æ•°å‡ ç‡å‡½æ•°ï¼Œå…¶è¾“å‡ºæ˜¯ä»‹äº0~1ä¹‹é—´è¿ç»­æ¦‚ç‡å€¼ã€‚ä»”ç»†æŸ¥çœ‹ï¼Œä¸éš¾å‘ç°ï¼Œå½“çœŸå®å€¼ æ—¶ï¼Œç¬¬ä¸€é¡¹ä¸º0ï¼Œå½“çœŸå®å€¼ æ—¶ï¼Œç¬¬äºŒé¡¹ä¸º0ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæŸå¤±å‡½æ•°å…¶å®åœ¨æ¯æ¬¡è®¡ç®—æ—¶æ°¸è¿œéƒ½åªæœ‰ä¸€é¡¹åœ¨å‘æŒ¥ä½œç”¨ï¼Œé‚£è¿™ä¸å°±å¯ä»¥è½¬æ¢ä¸ºåˆ†æ®µå‡½æ•°äº†å—ï¼Œåˆ†æ®µçš„å½¢å¼å¦‚ä¸‹: ä¸éš¾å‘ç°ï¼Œå½“çœŸå®å€¼ ä¸º1æ—¶ï¼Œè¾“å‡ºå€¼ è¶Šæ¥è¿‘1ï¼Œåˆ™ è¶Šå°ï¼Œå½“çœŸå®å€¼ ä¸º 0 æ—¶ï¼Œè¾“å‡ºå€¼ è¶Šæ¥è¿‘äº0ï¼Œåˆ™ è¶Šå° (å¯è‡ªå·±æ‰‹ç”»ä¸€ä¸‹ å‡½æ•°çš„æ›²çº¿)ã€‚è¯¥åˆ†æ®µå‡½æ•°æ•´åˆä¹‹åå°±æ˜¯ä¸Šé¢æˆ‘ä»¬æ‰€åˆ—å‡ºçš„ logloss æŸå¤±å‡½æ•°çš„å½¢å¼ã€‚ 3.ä½¿ç”¨æ¢¯åº¦ä¸‹é™ä¼˜åŒ–æ±‚è§£æˆ‘ä»¬ç¡®å®šäº†æ¨¡å‹çš„æŸå¤±å‡½æ•°ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®è¿™ä¸ªæŸå¤±å‡½æ•°ï¼Œä¸æ–­çš„ä¼˜åŒ–æ¨¡å‹çš„å‚æ•°ï¼Œä»è€Œè·å¾—æ‹Ÿåˆæ•°æ®çš„æœ€ä½³æ¨¡å‹ã€‚æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š $$L(w,b) = -[ylny^* + (1-y)ln(1-y^*)], æ³¨æ„yä¸æ˜¯è‡ªå˜é‡ï¼Œy^*=\\frac{1}{1+e^{-z}}, z = w^Tx + b$$ æœ€å°åŒ–æŸå¤±å€¼ä¾¿å¾—åˆ° $(w^*,b^*) = argmin_{w,b}(L(w,b))$ æ¢¯åº¦ä¸‹é™ä¸­çš„$(w,b)$çš„æ›´æ–°æ–¹å¼ $$w \\leftarrow w - \\alpha\\frac{\\partial L}{\\partial w}$$ $$b \\leftarrow b - \\alpha\\frac{\\partial L}{\\partial b}$$ ç”±å¾®ç§¯åˆ†çš„é“¾å¼æ±‚å¯¼å¯ä»¥å¾—åˆ° $$\\frac{\\partial L}{\\partial w} = \\frac{\\partial L}{\\partial y^*} \\frac{\\partial y^*}{\\partial z} \\frac{\\partial z}{\\partial w} = (y^* - y)x$$ $$\\frac{\\partial L}{\\partial b} = \\frac{\\partial L}{\\partial y^*} \\frac{\\partial y^*}{\\partial z} \\frac{\\partial z}{\\partial b}=y^*-y$$ è½¬åŒ–ä¸ºçŸ©é˜µè¿ç®—ï¼š ä¸ºäº†ç®€ä¾¿è¿ç®—æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šæ·»åŠ ä¸€ä¸ªå…¨ä¸º1çš„åˆ—ï¼Œä½¿åç½®ç³»æ•°bæ›´æ–°çš„æ—¶å€™ä¸å—xå€¼å¾—å½±å“ï¼Œæ¥ç€ä»¤$\\beta = (W,b)$é‚£ä¹ˆå‚æ•°æ›´æ–°å°±å¯ä»¥å†™ä¸º $$\\beta = \\beta - \\alpha X^T(Y^* - Y)$$ã€‚ å…¶ä¸­å®ƒä»¬çš„shapeå¦‚ä¸‹ï¼š $$\\begin{cases} \\beta &amp; (n,1) \\ X &amp; (m,n) \\ Y^*,Y&amp;(m,1)\\end{cases}$$ ä»£ç å®ç°ä¸‹é¢æ˜¯ä»£ç å®ç°çš„éƒ¨åˆ†ï¼Œå…¶ä¸­æ•°æ®å¤„ç†éƒ¨åˆ†å äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œæ ¸å¿ƒçš„æ¢¯åº¦ä¸‹é™éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920def gradient_secent(x_train, y_train): ''' args: x_train: m x n y_train: m x 1 return: wb ''' lr_rate, threshold = 1, 0.01 # åˆå§‹åŒ–å­¦ä¹ é€Ÿåº¦å’Œé˜ˆå€¼ wb = np.ones((x_train.shape[1], 1)) # n x 1, è¿™é‡Œçš„wbå°±æ˜¯åˆšåˆšçš„è´å¡”ï¼ˆå°±æ˜¯é‚£ä¸ªå’ŒBå¾ˆåƒçš„å­—æ¯ï¼‰ g = np.zeros((x_train.shape[1], 1)) # ä½¿ç”¨adagradæ›´æ–°å­¦ä¹ é€Ÿç‡ï¼Œ y_predict = get_y_predict(wb, x_train) loss_value = get_loss_value(wb, y_train, y_predict) # è®¡ç®—æŸå¤±å€¼ while True: wb, g = update_parameter(wb, lr_rate, x_train, y_train, y_predict, g) y_predict = get_y_predict(wb, x_train) pre_loss_value, loss_value = loss_value, get_loss_value( wb, y_train, y_predict) if abs(pre_loss_value - loss_value) &lt; threshold: break return wb å®Œæ•´çš„ä»£ç éƒ¨åˆ†å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182#!/usr/bin/env python# encoding: utf-8import pandas as pdimport numpy as npimport matplotlib.pyplot as pltdef binary_value(column_data,cond): ''' args: column_data: éœ€è¦äºŒå€¼åŒ–çš„åˆ— cond: äºŒå€¼åŒ–çš„æ¡ä»¶ï¼Œç¬¦åˆè¯¥æ¡ä»¶çš„è®¾ç½®ä¸º1å¦åˆ™ä¸º0 return: è¿”å›å¤„ç†å¥½çš„æ•°æ® ''' column_data.mask(cond=cond,other=1,inplace=True) column_data.where(cond=column_data==1,other=0,inplace=True) #print(column_data) return column_data.astype('int64')def one_hot_scale(data): ''' å¯¹æ•°æ®è¿›è¡Œone-hotç¼–ç ï¼Œå¹¶è¿›è¡Œç¼©æ”¾. args: data: åŸå§‹æ•°æ® return: å¤„ç†åçš„æ•°æ® ''' object_columns = [column for column in data.columns if data[column].dtype == 'object'] number_columns = [column for column in data.columns if data[column].dtype == 'int64' and column != 'income' and column != 'sex'] object_columns, number_columns = data[object_columns],data[number_columns] # æå–ç›¸åº”çš„åˆ— # å¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–ç¼©æ”¾,ç¼©æ”¾åå€¼åœ¨0-1ä¹‹é—´ number_columns = (number_columns - number_columns.min()) / (number_columns.max() - number_columns.min()) object_columns = pd.get_dummies(object_columns) data = pd.concat([object_columns, number_columns, data['sex'], data['income']],axis=1) return datadef data_pre_process(df_data,df_test_data): ''' 1. è¿›è¡Œæ•°æ®é¢„å¤„ç† 2. è¿”å›è®­ç»ƒé›†å’ŒéªŒè¯é›† ''' df_data,df_test_data = df_data.fillna(0),df_test_data.fillna(0) # å¯¹ç©ºå€¼è¿›è¡Œå¡«å…… # å¯¹æ€§åˆ«å’Œincomeåˆ—å¤„ç† df_data['sex'] = binary_value(df_data['sex'].copy(deep=True),cond=df_data['sex']==' Male') df_test_data['sex'] = binary_value(df_test_data['sex'].copy(deep=True),cond=df_test_data['sex']==' Male') df_data['income'] = binary_value(df_data['income'].copy(deep=True),cond=df_data['income']==' &gt;50K') df_data = one_hot_scale(df_data) df_test_data= one_hot_scale(df_test_data) # æŠŠè®­ç»ƒé›†åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›† x_train = df_data.iloc[:int(len(df_data.index) * 0.80), :] x_valid = df_data.iloc[int(len(df_data.index) * 0.80):, :] y_train = np.array(x_train.iloc[:, -1:]) x_train = np.array(x_train.iloc[:, :-1]) x_train = np.c_[x_train, np.ones((x_train.shape[0], 1))] # æ·»åŠ ä¸€ä¸ªæ¨ªä¸º1çš„åˆ—ï¼Œç”¨äºç®€åŒ–åç½®ç³»æ•°bçš„æ›´æ–° y_valid = np.array(x_valid.iloc[:, -1:]) x_valid = np.array(x_valid.iloc[:, :-1]) x_valid = np.c_[x_valid, np.ones((x_valid.shape[0], 1))] y_test = np.array(df_test_data.iloc[:,-1:]) x_test = np.array(df_test_data.iloc[:,:-1]) x_test = np.c_[x_test, np.ones((x_test.shape[0], 1))] # æ·»åŠ ä¸€ä¸ªæ¨ªä¸º1çš„åˆ—ï¼Œç”¨äºç®€åŒ–åç½®ç³»æ•°bçš„æ›´æ–° return x_train, y_train, x_valid, y_valid,x_test,y_testdef gradient_secent(x_train, y_train): ''' args: x_train: m x n y_train: m x 1 return: wb ''' lr_rate, threshold = 1, 5 wb = np.ones((x_train.shape[1], 1)) # n x 1 g = np.zeros((x_train.shape[1], 1)) y_predict = get_y_predict(wb, x_train) loss_value = get_loss_value(wb, y_train, y_predict) # è®¡ç®—æŸå¤±å€¼ loss_value_list = [] while True: loss_value_list.append(loss_value) wb, g = update_parameter(wb, lr_rate, x_train, y_train, y_predict, g) y_predict = get_y_predict(wb, x_train) pre_loss_value, loss_value = loss_value, get_loss_value(wb, y_train, y_predict) if abs(pre_loss_value - loss_value) &lt; threshold: break # å¾ªç¯ç»“æŸæ¡ä»¶ plot_loss_value(loss_value_list) #ç”»å›¾ return wbdef update_parameter(wb, lr_rate, x_train, y_train, y_predict, g): ''' args: wb: n x 1 g: adagrad é‡Œçš„ G, n x 1 lr_rate: å­¦ä¹ é€Ÿç‡ y_train: çœŸå®å€¼ï¼Œm x 1 y_predict: é¢„æµ‹å€¼ï¼Œm x 1 return: wb, g ''' descent = x_train.T.dot(y_predict - y_train) # n x 1 g = g + descent * descent lr_rates = lr_rate / (np.sqrt(g + 0.00000001)) # n x 1 wb = wb - lr_rates * descent return wb, gdef get_y_predict(wb, x_train): ''' args: wb: å‚æ•°ï¼Œn x 1 x_train: è®­ç»ƒé›†ï¼Œm x n return:è®¡ç®—é¢„æµ‹å€¼ y.shape = m x 1 ''' y = wb.T.dot(x_train.T) # 1 x n * n x m = 1 x m y = 1 / (np.exp(-1 * y) + 1) # 1 x m y = y.T # m x 1 return ydef get_loss_value(wb, y_train, y_predict): ''' args: wb: å‚æ•°ï¼Œn x 1 y_train: çœŸå®å€¼ï¼Œm x 1 y_predict: é¢„æµ‹å€¼ï¼Œm x 1 return: loss_value, æŸå¤±å€¼ ''' res = y_train.T.dot(np.log(y_predict)) # 1 x m * m x 1 res = -1 * res tmp = (y_train - 1).T.dot(np.log(1 - y_predict)) res = res + tmp return res[0][0]def get_acc(wb, x, y): ''' args: wb: n x 1 x: m x n y: m x 1 return: æ­£ç¡®ç‡ acc ''' y_predict = get_y_predict(wb, x) # m x 1 y_predict[y_predict &gt; 0.5] = 1 y_predict[y_predict &lt;= 0.5] = 0 acc = sum(y_predict == y)[0] / y.shape[0] return accdef test_data_process(df_data): ''' args: df_data: m x n return: x_test, y_test '''def main(): train_data = pd.read_csv('./data/train.csv') test_data = pd.read_csv('./data/test.csv') x_train, y_train, x_valid,y_valid,x_test,y_test = data_pre_process(train_data,test_data) wb = gradient_secent(x_train, y_train) valid_acc = get_acc(wb, x_valid, y_valid) print(&quot;valid accuracy:{}&quot;.format(valid_acc)) test_acc = get_acc(wb,x_test,y_test) print(&quot;tet accuracy:{}&quot;.format(test_acc)) plt.show()def plot_loss_value(loss_values): ''' ç”»å‡ºloss valueçš„å˜åŒ–å›¾ ''' plt.plot(range(len(loss_values)),loss_values,linewidth=4,color='g')if __name__ == '__main__': ''' æå®æ¯…æœºå™¨å­¦ä¹ ç¬¬äºŒæ¬¡ä½œä¸š 1. å¯¹æ•°å‡ ç‡å›å½’ 2. ä½¿ç”¨æ¢¯åº¦ä¸‹é™å¯»æ‰¾æœ€ä¼˜è§£ ''' print(&quot;æ­£åœ¨æ‰§è¡Œä¸­ï¼Œå¯èƒ½éœ€è¦è€—è´¹å¤§é‡æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡10åˆ†é’Ÿæœªå“åº”è¯·æ‰‹åŠ¨å…³æ‰å³å¯ã€‚&quot;) main() è¿è¡Œæˆªå›¾ï¼š å¯ä»¥çœ‹å‡ºåœ¨éªŒè¯é›†å’Œæµ‹è¯•é›†ä¸­æ­£ç¡®ç‡è¿˜ç®—çœ‹çš„è¿‡å»ã€‚ã€‚ã€‚å¯èƒ½åšäº†ç‰¹å¾å·¥ç¨‹åæ­£ç¡®ç‡ä¼šé«˜ä¸€ç‚¹ã€‚ å‚è€ƒé“¾æ¥æ„Ÿè°¢ä¸‹é¢çš„åšä¸»å’Œä½œè€…ã€‚ ã€Šæœºå™¨å­¦ä¹ ã€‹â€”â€”å‘¨å¿—å å¯¹æ•°å‡ ç‡å›å½’ â€”â€” Logistic Regression æ•°æ®é›†è¿æ¥","link":"/posts/2a54212a.html"},{"title":"æéªŒ-3ä»£ä¸€é”®é€šè¿‡æ¨¡å¼-åæ··æ·†fullpage.9.1.9.cyhomb.js","text":"æ¡ˆä¾‹åœ°å€: aHR0cHM6Ly9kZW1vcy5nZWV0ZXN0LmNvbS9mdWxscGFnZS5odG1s 1. åˆ†ææ•´ä¸ªè¯·æ±‚æµç¨‹å…ˆåˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ•´ä½“æµç¨‹ï¼Œå¦‚å›¾æ€»å…±æœ‰4ä¸ªå…³é”®è¯·æ±‚ã€‚ 1. register-fullpage è¿™ä¸ªè¯·æ±‚ç”¨äºè·å–gtå’Œchallengeå‚æ•°ï¼Œåé¢ä¼šç”¨åˆ°ã€‚ è¿™ä¸ªè¯·æ±‚ç”¨äºè·å–gtå’Œchallengeå‚æ•°ï¼Œåé¢ä¼šç”¨åˆ° 2. gettype.php çœ‹è¯·æ±‚çš„åå­—æ˜¯è·å–éªŒè¯ç çš„ç±»å‹ï¼Œè¯·æ±‚æ—¶éœ€è¦å¸¦ç€ç¬¬ä¸€æ­¥çš„gtå‚æ•°ã€‚ çœ‹è¯·æ±‚çš„åå­—æ˜¯è·å–éªŒè¯ç çš„ç±»å‹ï¼Œè¯·æ±‚æ—¶éœ€è¦å¸¦ç€ç¬¬ä¸€æ­¥çš„gtå‚æ•°ã€‚ 3. get.phpè¿™ä¸ªè¯·æ±‚å°±æœ‰è¯´æ³•äº†ï¼Œå–œé—»ä¹è§çš„wå€¼å°±åœ¨å…¶è¯·æ±‚å‚æ•°å†…ï¼Œé™¤äº†wå€¼å¤–è¿˜æœ‰gtå’Œchallengeå‚æ•°ã€‚å…¶ä¸­gtå’Œchallengeå‚æ•°æ˜¯ç¬¬ä¸€æ­¥register-fullpageè¯·æ±‚ä¸­å¾—åˆ°çš„ï¼Œå…³é”®å‚æ•°å°±æ˜¯wå€¼ã€‚è¿™é‡Œå¦‚æœé€šè¿‡å…¨å±€æœç´¢wå­—ç¬¦ä¸²å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆçš„ä½ç½®ï¼Œè€Œä¸”è¿™ä¸ªè¯·æ±‚ä¸æ˜¯xhrè¯·æ±‚ï¼Œæ²¡åŠæ³•é€šè¿‡xhræ–­ç‚¹æ–­ä½ï¼Œè¿™é‡Œç”¨initiatorçš„è¿›è¡Œè¿½è¸ªï¼šæœ€ç»ˆå¯ä»¥å®šä½åˆ°fullpage.9.1.9-cyhomb.jsæ–‡ä»¶ï¼Œçœ‹å®ƒæ ·å­å°±çŸ¥é“å…«ä¹ä¸ç¦»åå°±æ˜¯å®ƒäº†ã€‚å¯çœ‹åˆ°è¿™æ˜¯ç»è¿‡æ··æ·†çš„jsæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥ä¸ºäº†æ–¹ä¾¿åˆ†æä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡astæ¥è¿›è¡Œé€‚å½“çš„è¿˜åŸæ··æ·†çš„ä»£ç ï¼Œåœ¨æ­£å¼å¼€å§‹åæ··æ·†ä¹‹å‰å¯ä»¥å…ˆç”¨v_jstoolå·¥å…·è¿›è¡Œä¸€æ¬¡æ™®é€šè§£æ··æ·†ï¼Œè¿™ä¸€æ­¥ä¼šå¯¹ä»£ç ä¸­çš„unicodeå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ï¼Œä»¥åŠä¸€äº›åŸºç¡€çš„åæ··æ·†æ“ä½œã€‚ 2. ä½¿ç”¨astè¿›è¡Œåæ··æ·†è¿™é‡Œæ˜¯babelç›¸å…³çš„åº“æ¥è¿›è¡Œè§£æ··æ·†ï¼Œé…åˆ[https://astexplorer.net/](https://astexplorer.net/)ç½‘ç«™é£Ÿç”¨ã€‚ 2.1 ä»‹ç»ä¸€ä¸‹babel Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨â€‹ï¼ŒBabelä»¥åŠä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°†é‡‡ç”¨ ECMAScript 2015+ è¯­æ³•ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯ Babel èƒ½ä¸ºä½ åšçš„äº‹æƒ…ï¼š è¯­æ³•è½¬æ¢ é€šè¿‡ Polyfill æ–¹å¼åœ¨ç›®æ ‡ç¯å¢ƒä¸­æ·»åŠ ç¼ºå¤±çš„åŠŸèƒ½ï¼ˆé€šè¿‡å¼•å…¥ç¬¬ä¸‰æ–¹ polyfill æ¨¡å—ï¼Œä¾‹å¦‚ core-jsï¼‰ æºç è½¬æ¢ï¼ˆcodemodsï¼‰ è¿™æ˜¯babelæ–‡æ¡£ä¸­å¯¹äºå®ƒçš„ä»‹ç»ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ°çš„æ˜¯å®ƒçš„æºç è½¬æ¢åŠŸèƒ½ã€‚ä¸¾ä¸ªæ —å­ï¼Œé€šè¿‡babelæˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹ä»£ç è¿›è¡Œç®€åŒ–æ–¹ä¾¿é˜…è¯»ã€‚ 12345var a,b,c = 1,2,3;// è½¬æ¢åvar a = 1;var b = 2;var c = 3; 123456789101112function add(x, y){ // è¿™ä¸¤è¡Œæ˜¯æ— ç”¨çš„å¹²æ‰°ä»£ç  var cc = ff.d; var dd = cc[0]; return x + y;}// è½¬æ¢åfunction add(x,y){ return x + y;} å½“ç„¶è¦å®Œæˆè¿™äº›æ“ä½œï¼Œé¦–å…ˆæ˜¯è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨babelï¼Œä¸ªäººè®¤ä¸ºä¸Šæ‰‹ä¸€ç§æ–°çš„æŠ€æœ¯æœ€å¥½çš„æ–¹æ³•å°±æ˜¯è¾¹çœ‹æ–‡æ¡£è¾¹å®è·µï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯æˆ‘åœ¨çœ‹å®Œbabelçš„æ–‡æ¡£åå®è·µçš„ã€‚é™„ä¸€ä¸‹babelçš„æ–‡æ¡£ï¼š https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md 2.2 ä½¿ç”¨astexplorerè¾…åŠ©ç¼–å†™astè„šæœ¬è¿™å…¶å®æ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªå·¦å³å¸ƒå±€çš„é¡µé¢ï¼Œå·¦è¾¹å†™å…¥jsä»£ç ï¼Œå³è¾¹ä¼šç»™å®ƒçš„æŠ½è±¡è¯­æ³•æ ‘ã€‚åœ¨ç¼–å†™è§£æ··æ·†ä»£ç æ—¶å¯ä»¥ä½¿ç”¨å®ƒè¿›è¡Œè¾…åŠ©ã€‚ 2.3 åˆ†ææ··æ·†åçš„ä»£ç é€šè¿‡vscodeæ‰“å¼€åï¼Œå°†æ‰€æœ‰ä»£ç å¿«æŠ˜å ï¼Œå¯ä»¥çœ‹åˆ°å¼€å¤´æœ‰ä¸€ä¸ªAFiupå‡½æ•°ï¼Œç„¶ååœ¨å®ƒå†…éƒ¨åˆå®šä¹‰äº†å‡ ä¸ªå‡½æ•°ï¼Œåœ¨æœ€åæœ‰ä¸€ä¸ªå¾ˆé•¿çš„è‡ªæ‰§è¡Œå‡½æ•°ã€‚ æµè§ˆä¸€ä¸‹æœ€åçš„è‡ªæ‰§è¡Œå‡½æ•°ï¼Œä¸éš¾å‘ç°é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨AFiup.$_CPå‡½æ•°çš„ä»£ç å—ï¼Œæ”¾åˆ°æµè§ˆå™¨æ‰§è¡Œä¸€ä¸‹å‘ç°è¿™ä¸ªå‡½æ•°åœ¨ä¼ å…¥ä¸€ä¸ªæ•°å­—åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å¥½ï¼Œé‚£ç¬¬ä¸€æ­¥å°±æ˜¯è¿˜åŸå¯¹AFiup.$_CPå‡½æ•°çš„è°ƒç”¨ã€‚ 2.4 è¿˜åŸAFiup.$_CPå‡½æ•°è°ƒç”¨è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥å¯¹AFiup.$_CPçš„è°ƒç”¨è¿›è¡Œè¿˜åŸï¼Œå¯ä»¥çœ‹ä¸‹å®ƒçš„ç‰¹å¾ï¼š ä»£ç ä¸­å¯¹å…¶è¿›è¡Œè°ƒç”¨çš„å‚æ•°éƒ½æ˜¯å­—é¢é‡ï¼Œåƒ659ã€89è¿™ç§ï¼Œä¸æ¶‰åŠåˆ°å…¶ä»–çš„å˜é‡æˆ–è€…æ˜¯å‡½æ•°ä¹‹ç±»çš„ã€‚ $_CPå‡½æ•°åœ¨ä¼ å…¥å‚æ•°ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ— è®ºè°ƒç”¨æ¬¡æ•°æˆ–æ‰§è¡Œç¯å¢ƒå¦‚ä½•å˜åŒ–ï¼Œå‡½æ•°å§‹ç»ˆè¿”å›ç›¸åŒçš„è®¡ç®—ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°æˆ–è€…å«ç¡®å®šæ€§å‡½æ•°ã€‚å½“ç„¶è¿™éœ€è¦åœ¨æµè§ˆå™¨å’Œnodejsä¸­è¿›è¡ŒéªŒè¯ï¼Œæ‰èƒ½å¾—åˆ°çš„ç»“è®ºï¼Œè¿™é‡Œå°±ç•¥è¿‡äº†ã€‚æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æŠŠå®ƒåœ¨åæ··æ·†è„šæœ¬ä¸­å®šä¹‰å¥½ï¼Œç„¶ååœ¨ä½¿ç”¨babeléå†è¯­æ³•æ ‘ï¼Œåœ¨è°ƒç”¨çš„åœ°æ–¹ç›´æ¥ç”¨ç»“æœå°†è°ƒç”¨èŠ‚ç‚¹æ›¿æ¢æ‰ã€‚æ¯”å¦‚è¯´ä¸‹é¢ä»£ç ä¸­çš„$_BIJHw(89) ``$_BIJHw(34) ã€ 1234567891011var $_BIJHw = AFiup.$_CP;var $_BIJGv = [&quot;$_BJAAQ&quot;].concat($_BIJHw);var $_BIJID = $_BIJGv[1];$_BIJGv.shift();var $_BIJJe = $_BIJGv[0];var _;var e = Object[$_BIJHw(89)];var c = e[$_BIJHw(34)];var t; æ€è·¯å¦‚ä¸‹ï¼š 1. é¦–å…ˆå®šä½åˆ°ç±»ä¼¼var $_BIJHw = AFiup.$_CP;è¯­å¥ 1. æŸ¥æ‰¾$_BIJHwå˜é‡æ‰€æœ‰çš„å¼•ç”¨ä½ç½®ï¼Œæ‰¾åˆ°å…¶ä¸­ç±»ä¼¼$_BIJHw(xxx)çš„ä½ç½®ï¼Œå…¶ä¸­xxxæ„æ€æ˜¯çº¯æ•°å­— 1. æ‹¿åˆ°xxxå€¼ï¼Œæœ¬åœ°è°ƒç”¨åæ›¿æ¢èŠ‚ç‚¹.å®Œæ•´çš„visitorä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435const replaceCallAFiup$_CP = { VariableDeclaration(path) { // å®šä½åˆ°ç±»ä¼¼çš„è¯­å¥var _ccc = AFiup.$_CP; if ( types.isVariableDeclaration(path.node) &amp;&amp; path.node.declarations.length === 1 &amp;&amp; types.isVariableDeclarator(path.node.declarations[0]) &amp;&amp; types.isIdentifier(path.node.declarations[0].id) &amp;&amp; types.isMemberExpression(path.node.declarations[0].init) &amp;&amp; types.isIdentifier(path.node.declarations[0].init.object) &amp;&amp; types.isIdentifier(path.node.declarations[0].init.property) &amp;&amp; path.node.declarations[0].init.property.name === &quot;$_CP&quot; ) { var varName = path.node.declarations[0].id.name; // æŸ¥æ‰¾varNameå˜é‡çš„æ‰€æœ‰å¼•ç”¨ let binding = path.scope.getBinding(varName); binding.referencePaths.forEach(refPath =&gt; { if ( types.isCallExpression(refPath.parent) &amp;&amp; refPath.parent.arguments.length === 1 &amp;&amp; types.isNumericLiteral(refPath.parent.arguments[0]) ) { let callArgumentInt = refPath.parent.arguments[0].value; console.log(`${refPath.parentPath.toString()} --&gt; ${AFiup.$_CP(callArgumentInt)}`) refPath.parentPath.replaceWith(types.valueToNode(AFiup.$_CP(callArgumentInt))) } }); } // æœ€ååˆ«å¿˜äº†åˆ·æ–°scope path.scope.crawl(); },}; æ‰§è¡Œä»¥ä¸‹å¯ä»¥çœ‹åˆ°æ›¿æ¢æ‰äº†å¾ˆå¤šçš„èŠ‚ç‚¹ï¼šç„¶åæ¥ç€åˆ†æä»£ç ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†AFiup.$_CPå‡½æ•°çš„è°ƒç”¨ï¼Œæ˜¯æ¯”è¾ƒç»•çš„ï¼Œå…ˆæ˜¯èµ‹å€¼ç»™å˜é‡$_CHIHcï¼Œæ¥ç€å°†å…¶concatåˆ°$_CHIGyç„¶åå˜é‡$_CHIJTåˆä»$_CHIGyä¸­å–å‡ºæ¥ã€‚æœ€ååœ¨é€šè¿‡è°ƒç”¨$_CHIIJçš„æ–¹å¼æ¥è°ƒç”¨AFiup.$_CPå‡½æ•°ã€‚æ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡Œå¦‚æœå°†var $_CHIJT = $_CHIGy[0];æ›¿æ¢æˆvar $_CHIJT = AFiup.$__CPå°±å¯ä»¥ç›´æ¥å¤ç”¨ä¸Šä¸€æ­¥å†™çš„visitoräº†ã€‚é‚£æ€è·¯å°±æœ‰äº†ï¼š ä¾æ¬¡åŒ¹é…è¯­å¥1ã€2ã€3ã€4ã€5 å°†è¯­å¥5è¿›è¡Œæ›¿æ¢ï¼Œæ ¼å¼:var xxx = AFiup.$_CP 123456var $_CHIHc = AFiup.$_CP; // è¯­å¥1var $_CHIGy = [&quot;$_CHJAQ&quot;].concat($_CHIHc); // è¯­å¥2var $_CHIIJ = $_CHIGy[1]; // è¯­å¥3$_CHIGy.shift(); // è¯­å¥4var $_CHIJT = $_CHIGy[0]; // è¯­å¥5e[$_CHIIJ(1220)](); å®Œæ•´çš„visitorä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940const replaceCallAFiup$_CP = { VariableDeclaration(path) { if ( types.isVariableDeclaration(path.node) &amp;&amp; path.node.declarations.length === 1 &amp;&amp; types.isVariableDeclarator(path.node.declarations[0]) &amp;&amp; types.isIdentifier(path.node.declarations[0].id) &amp;&amp; types.isMemberExpression(path.node.declarations[0].init) &amp;&amp; types.isIdentifier(path.node.declarations[0].init.object) &amp;&amp; types.isLiteral(path.node.declarations[0].init.property) &amp;&amp; path.node.declarations[0].init.property.value === 1 ) { const memberExpression = types.memberExpression( types.identifier(&quot;AFiup&quot;), // å¯¹è±¡ï¼šAFiup types.identifier(&quot;$_CP&quot;), // å±æ€§ï¼š$_CP false // éè®¡ç®—å±æ€§ï¼ˆå³ç”¨ç‚¹ç¬¦å·è®¿é—®ï¼Œè€Œéæ–¹æ‹¬å·ï¼‰ ); // åˆ›å»ºå˜é‡å£°æ˜ç¬¦ $_FCIU = AFiup.$_CP const declarator = types.variableDeclarator( types.identifier( path.node.declarations[0].id.name ), // å˜é‡å memberExpression // åˆå§‹å€¼ ); // åˆ›å»ºå®Œæ•´çš„å˜é‡å£°æ˜èŠ‚ç‚¹ var $_FCIU = AFiup.$_CP const newNode = types.variableDeclaration( &quot;var&quot;, // kind: var [declarator] // declarations æ•°ç»„ ); const beforeCode = path.toString(); path.replaceWith(newNode); console.log(`${beforeCode} -&gt; ${path.toString()}`); } // å®šä½åˆ°ç±»ä¼¼çš„è¯­å¥var _ccc = AFiup.$_CP; ...}; 2.5 ç§»é™¤æ— ç”¨ä»£ç å¾ˆç®€å•çš„æ“ä½œä¸å¤šè¯´äº† 1234567891011121314151617181920212223242526272829303132333435363738394041const pluginRemoveUnuseVarDeclaration = { VariableDeclaration(path) { const declarations = path.node.declarations; // æ”¶é›†æ‰€æœ‰å˜é‡çš„å¼•ç”¨ä¿¡æ¯ const bindings = new Map(); declarations.forEach((decl) =&gt; { const binding = path.scope.getBinding(decl.id.name); if (binding) { bindings.set(decl.id.name, binding.referencePaths.length); } }); // è¿‡æ»¤å‡ºæœªä½¿ç”¨çš„å˜é‡å£°æ˜ const unusedDeclarations = declarations.filter((decl) =&gt; { return bindings.get(decl.id.name) === 0; }); // å¦‚æœæ‰€æœ‰å£°æ˜éƒ½æœªä½¿ç”¨ï¼Œåˆ é™¤æ•´ä¸ªå£°æ˜è¯­å¥ if (unusedDeclarations.length === declarations.length) { console.log( `ç§»é™¤æ•´ä¸ªæœªä½¿ç”¨çš„å˜é‡å£°æ˜è¯­å¥ï¼ŒåŒ…å« ${declarations .map((d) =&gt; d.id.name) .join(&quot;, &quot;)}` ); path.remove(); } // å¦åˆ™åªåˆ é™¤æœªä½¿ç”¨çš„å£°æ˜ else if (unusedDeclarations.length &gt; 0) { console.log( `ç§»é™¤éƒ¨åˆ†æœªä½¿ç”¨çš„å˜é‡: ${unusedDeclarations .map((d) =&gt; d.id.name) .join(&quot;, &quot;)}` ); path.node.declarations = declarations.filter( (decl) =&gt; !unusedDeclarations.includes(decl) ); } path.scope.crawl(); },}; 3. åˆ†æåæ··æ·†åçš„ä»£ç æ›¿æ¢æ‰AFiup.$_CPå‡½æ•°è°ƒç”¨åä»£ç åŸºæœ¬ä¸Šå°±å¯è¯»äº†ï¼Œåé¢å°±å¯ä»¥ç”¨åæ··æ·†çš„æ–‡ä»¶æ›¿æ¢æ‰æµè§ˆå™¨ä¸Šçš„è¿›è¡Œåˆ†æäº†ã€‚","link":"/posts/e474db30.html"},{"title":"æŸå®‰X-App-Tokenå‚æ•°é€†å‘|åŸºäºunidbgæ¨¡æ‹Ÿè°ƒç”¨ç”Ÿæˆ","text":"è®°å½•ä½¿ç”¨unidbgè¿˜åŸsoå±‚åŠ å¯†å‡½æ•°çš„ä¸€æ¬¡å°è¯• ç›®æ ‡ä½¿ç”¨unidbgå¯¹APPçš„æ¥å£ç­¾åå­—æ®µX-App-Tokenè¿›è¡Œç”Ÿæˆã€‚ ç›®æ ‡APP: 6YW35a6JVjEzLjEuMQ== 1. æŠ“åŒ…åˆ†æè¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œä½¿ç”¨Posterné…ç½®charleså°±å¯ä»¥å®ŒæˆæŠ“åŒ…ï¼Œæ‰¾åˆ°è·å–åŠ¨æ€è¯¦æƒ…çš„æ¥å£https://api2.coolapk.com/v6/feed/detail?id=44874711å…¶ä¸­idä¸ºå‘æ–‡çš„idï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å—postè¯·æ±‚çš„æ¥å£ï¼Œå…¶ä¸­åœ¨è¯·æ±‚headersä¸­æœ‰ä¸¤ä¸ªé†’ç›®çš„å­—æ®µX-App-Versionå’ŒX-App-Deviceï¼Œç»è¿‡æµ‹è¯•ä¸¤ä¸ªå­—æ®µç¼ºä¸€ä¸å¯ã€‚ ç¼ºå°‘å­—æ®µçš„å…¶ä¸­ä»»ä¸€å­—æ®µæˆ–è¿›è¡Œç¯¡æ”¹ä¼šæç¤ºè¯·æ±‚æœªéªŒè¯ 12345{ &quot;status&quot;: 1004, &quot;error&quot;: null, &quot;message&quot;: &quot;è¯·æ±‚æœªéªŒè¯&quot;} 2. åç¼–è¯‘APPè¿™ä¸€æ­¥æˆ‘ä»¬ä½¿ç”¨jadxè¿›è¡Œåç¼–è¯‘ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªappä½¿ç”¨äº†360çš„åŠ å›ºï¼Œéœ€è¦è¿›è¡Œè„±å£³å¤„ç†ï¼Œæˆ‘è¿™ä½¿ç”¨https://github.com/hluwa/frida-dexdumpè¿›è¡Œè„±å£³ã€‚ å®‰è£…frida-dexdumpå¯ä»¥ç›´æ¥ä½¿ç”¨pipè¿›è¡Œå®‰è£…pip install frida-dexdumpï¼Œè¦æ³¨æ„ç‰ˆæœ¬éœ€è¦å’Œä½ ä½¿ç”¨çš„frida-serverç‰ˆæœ¬å¯¹åº”ã€‚ è¿™é‡Œæä¾›æˆ‘çš„ç‰ˆæœ¬ä¿¡æ¯ä¾›å‚è€ƒ ç‰ˆæœ¬ å¤‡æ³¨ python 3.7 frida-server 16.0.0 frida-dexdump 2.0.1 frida-tools 12.0.1 ä¹‹ååœ¨æ‰‹æœºç«¯æ‰“å¼€æŸå®‰APPï¼Œç”µè„‘ç«¯å‘½ä»¤è¡Œä¸­æ‰§è¡Œfrida-dexdump -FUè¿›è¡Œè„±å£³ï¼Œ-FUçš„å«ä¹‰æ˜¯æŒ‡å®šå‰å°åº”ç”¨ã€‚ å®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ä¸‹çš„{APP_NAME}ç›®å½•ä¸­å†™å…¥è„±å‡ºæ¥çš„dexæ–‡ä»¶ã€‚ä¸è¿‡è¿™æ—¶å€™è„±å‡ºæ¥çš„dexæ–‡ä»¶ä¸èƒ½ç›´æ¥æ‹¿åˆ°jadxä¸­è¿›è¡Œåç¼–è¯‘è¿˜éœ€è¦ä½¿ç”¨https://github.com/luoyesiqiu/DexRepairè¿›è¡Œå¤´éƒ¨ä¿®å¤ã€‚è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªå°è„šæœ¬æ¥è°ƒç”¨ 123456789101112131415161718192021222324import clickimport pathlibimport osfrom loguru import loggerfrom tqdm import tqdm@click.command()@click.option(&quot;--path&quot;, default=&quot;./&quot;, help=&quot;dexæ–‡ä»¶ç›®å½•æ‰€æœ‰è·¯å¾„&quot;)def main(path): logger.info(&quot;&quot;&quot; éœ€è¦åœ¨å½“å‰ç›®å½•ä¸‹æ”¾ç½®æ–‡ä»¶&quot;DexRepair.jar&quot;\\n å¯åœ¨: &quot;https://github.com/luoyesiqiu/DexRepair&quot; ä¸‹è½½ &quot;&quot;&quot;) path = pathlib.Path(path) for file_path in tqdm(path.rglob(&quot;*.dex&quot;)): logger.info(&quot;start {}&quot;.format(file_path)) os.system(&quot;java -jar DexRepair.jar {}&quot;.format(file_path)) logger.info(&quot;completed&quot;)if __name__ == &quot;__main__&quot;: main() å°†ä¿®å¤åçš„dexæ–‡ä»¶æ‹–å…¥åˆ°jadxä¸­è¿›è¡Œåˆ†æã€‚ 3. åˆ†æå­—æ®µç”Ÿæˆé€»è¾‘åœ¨jadxä¸­å…¨å±€æœç´¢X-App-Token(è¿™ä¸€æ­¥æ“ä½œå¯èƒ½ä¼šå¾ˆå¡)ã€‚ç»“æœåªæœ‰ä¸€æ¡ï¼Œä¸ç”¨çº ç»“ï¼Œå°±æ˜¯å®ƒ ç‚¹è¿›å»å¯ä»¥çœ‹åˆ°appTokenç”±getASå‡½æ•°ç”Ÿæˆ æ¥ç€ä½¿ç”¨objectionå¯¹è¿™ä¸ªå‡½æ•°è¿›è¡Œhookã€‚ æ­¥éª¤ï¼š adb è¿æ¥æ‰‹æœºï¼Œå¼€å¯frida-server é‡å¼€ä¸€ä¸ª shellçª—å£æŒ‡å®šå‘½ä»¤objection -g &quot;com.coolapk.market&quot; explore è¿›å…¥objectionååœ¨äº¤äº’çª—å£æŒ‡å®šå‘½ä»¤android hooking watch class_method 'com.coolapk.market.util.AuthUtils.getAS' --dump-args --dump-return æ²¡æœ‰é—®é¢˜çš„è¯ä¼šè¾“å‡ºæç¤º: ğŸ“¢è¿™é‡Œåœ¨ä½¿ç”¨Objection hookå‰æœ‰ä¸ªå°ç»†èŠ‚ï¼Œéœ€è¦å…ˆå°†appå¸è½½ï¼Œä¹‹åæ–­ç½‘ç¯å¢ƒä¸‹é‡è£…appï¼ŒhookæˆåŠŸåå†æ‰“å¼€ç½‘ç»œã€‚å¦‚æœä¸è¿™ä¹ˆåšçš„è¯ä¼šæç¤ºä½ Not found classã€‚çŒœæµ‹æ˜¯ç”±äº360åŠ å›ºçš„é—®é¢˜ï¼Œæ–­ç½‘æ˜¯ä¸ºäº†é˜²æ­¢360åŠ å›ºé€šè¿‡ç½‘ç»œæ›´æ–°ã€‚ æ‰“å¼€ç½‘ç»œåï¼Œæˆ‘è¯•ç€æ‰‹æœºä¸Šæ»‘åŠ¨ä¸€ä¸‹appï¼Œåœ¨objectionçš„çª—å£é‚£ï¼Œä¼šæ˜¾ç¤ºä¸€äº›ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°å·²ç»æ‰“å°å‡ºäº†getASå‡½æ•°çš„å…¥å‚å’Œè¿”å›å€¼ã€‚ å¯¹æ¯”ä¸€ä¸‹è¯·æ±‚ä¸­çš„headersä¸éš¾å‘ç°ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯X-App-Deviceè¿”å›å€¼å°±æ˜¯X-App-Tokenã€‚æ¥ç€æˆ‘ä»¬è¿›ä¸€æ­¥åˆ†æm44554å‡½æ•° æœ‰ä¸¤ä¸ªå…³é”®å­—: base64 reverse åˆç†çŒœæµ‹X-App-Deviceæ˜¯ç»è¿‡åè½¬åçš„base64ç¼–ç ï¼Œæ¥ç€æˆ‘ä»¬X-App-Deviceåè½¬å›å»å¹¶å°è¯•base64è§£ç . æœ€ç»ˆæ‹¿åˆ°x-app-deviceçš„æ˜æ–‡å€¼DUzuPzp3eMbe8yfL6IeDaAfOOI0Q7ts0KSbc; ; ; ; Google; google; Pixel 3; SP1A.210812.016.C2; nullï¼Œè¿™ä¸ªå­—ç¬¦ä¸²åˆ†äº†å¥½å‡ ä¸ªéƒ¨åˆ†ï¼Œæµ‹è¯•åå‘ç°ç¬¬ä¸€éƒ¨åˆ†çš„å­—ç¬¦ä¸²å¯ä»¥è¿›è¡Œç¯¡æ”¹ä¸åº”è¯¥æœ€ç»ˆç»“æœï¼Œè¿™é‡Œå°±ä¸å†æ·±å…¥äº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼ŒX-App-Deviceå‚æ•°æ˜¯ç”±ä¸€äº›ä¿¡æ¯ç»è¿‡base64ç¼–ç ååˆåè½¬å¾—åˆ°çš„ï¼›X-App-Tokenæ˜¯ç”±getASå‡½æ•°è¿›è¡ŒåŠ å¯†å¾—åˆ°çš„ã€‚ 4. ä½¿ç”¨unidbgè¿›è¡Œæ¨¡æ‹Ÿè°ƒç”¨ç”ŸæˆX-App-Tokenåœ¨jadxä¸­æŸ¥çœ‹ä¸€ä¸‹getASå‡½æ•°ï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªç”±jniè¿›è¡Œæ³¨å†Œçš„å‡½æ•°ï¼Œå¯¹åº”soæ–‡ä»¶çš„åç§°æ˜¯native-libã€‚æ¥ä¸‹æ¥ç¼–å†™unidbgè„šæœ¬è¿›è¡Œæ¨¡æ‹Ÿè°ƒç”¨ã€‚ è¿™é‡Œä¸å¤šä»‹ç»unidbgçš„ä½¿ç”¨ï¼Œè°ƒç”¨è„šæœ¬æºç å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package com.kuan;import com.github.unidbg.AndroidEmulator;import com.github.unidbg.arm.backend.Unicorn2Factory;import com.github.unidbg.linux.android.AndroidEmulatorBuilder;import com.github.unidbg.linux.android.AndroidResolver;import com.github.unidbg.linux.android.dvm.*;import com.github.unidbg.memory.Memory;import com.lvzhou.xvideo;import java.io.File;public class xAppToken extends AbstractJni{ private final AndroidEmulator emulator; private final DvmClass NativeApi; private final VM vm; public xAppToken(){ // åˆå§‹åŒ–ä¸€ä¸ªæ¨¡æ‹Ÿå™¨ // for64Bitä»£è¡¨ä½¿ç”¨arm64ï¼Œä¸€èˆ¬arm32æ›´å¸¸è§ // setProcessName è®¾ç½®è¿›ç¨‹åï¼Œæ¨èå¦‚å®è®¾ç½®ã€‚å¦‚æœä¸è®¾ç½®æ ·æœ¬åœ¨è°ƒç”¨getprognameæ—¶ä¼šè¿”å›'unidbg'å¯èƒ½ä¼šè§¦å‘åçˆ¬ emulator = AndroidEmulatorBuilder .for32Bit()// .addBackendFactory(new Unicorn2Factory(true)) // è®¾ç½®æŒ‡ä»¤æ‰§è¡Œå¼•æ“. .setProcessName(&quot;com.coolapk.market &quot;) .build(); Memory memory = emulator.getMemory(); memory.setLibraryResolver(new AndroidResolver(23)); vm = emulator.createDalvikVM(new File(&quot;unidbg/unidbg-android/src/test/resources/kuan/kuan.apk&quot;)); vm.setJni(this); vm.setVerbose(true); DalvikModule dm = vm.loadLibrary(&quot;native-lib&quot;, true); // å£°æ˜ä¸€ä¸ªDvmClassç±»// NativeApi = vm.resolveClass(&quot;com/weibo/xvideo/NativeApi&quot;); NativeApi = vm.resolveClass(&quot;com/coolapk/market/util/AuthUtils&quot;); dm.callJNI_OnLoad(emulator); } public static void main(String[] args) { xAppToken t = new xAppToken();// String result = xv.calls();// System.out.println(result); t.callGetAS(); } public String callGetAS(){// emulator.traceCode(); DvmObject&lt;?&gt; context = vm.resolveClass(&quot;android/content/Context&quot;).newObject(null); String xAppDevice = &quot;RFU5Q1Bsd2FGcTVKS0gxYU1KSHI4bkZaNWxhd1BYbzFnazk1OyA7IDsgOTA6RjA6NTI6OTQ6NUQ6QzU7IG1laXp1OyBtZWl6dTsgMTZzIFBybzsgRmx5bWUgOC4xLjguMEE7IDg0YzFkN2U2ODcwMjBjY2U4ODIxM2ExZmFjMjE2OTU0&quot;; String res = NativeApi.newObject(null).callJniMethodObject(emulator, &quot;getAS(Landroid/content/Context;Ljava/lang/String;)Ljava/lang/String;&quot;, context, xAppDevice).getValue().toString(); System.out.println(res); return res; }} æ‰§è¡Œç»“æœå¦‚å›¾: è¿™é‡Œç”¨çš„çŸ¥è¯†åªæ˜¯unidbgçš„åŸºæœ¬ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°è¡¥ç¯å¢ƒï¼Œè¿˜æ˜¯éå¸¸ç®€å•çš„ã€‚ 5. æ€»ç»“unidbgæ¨¡æ‹Ÿè°ƒç”¨ç›¸å¯¹äºfrida rpcæ¥è¯´æˆæœ¬ç›¸å½“ä½ï¼Œåªéœ€è¦ä¸€å°æœ‰javaç¯å¢ƒçš„æœåŠ¡å™¨å³å¯ã€‚","link":"/posts/507c1bbe.html"},{"title":"æ¢³ç†pythonçš„å¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨ã€ç”Ÿæˆå™¨","text":"åœ¨Pythonä¸­è¿™å‡ ä¸ªæ¦‚å¿µç»å¸¸ç”¨åˆ°ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“è¢«æ··æ·†ã€‚å†™è¿™ç¯‡ç¬”è®°ï¼Œåšä¸ªç®€å•çš„æ€»ç»“ã€‚ è¯´åœ¨å‰é¢çš„ä¸€äº›ç»“è®ºï¼š è¿­ä»£å™¨ä¸€å®šæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯è¿­ä»£å¯¹è±¡å´ä¸ä¸€å®šæ˜¯è¿­ä»£å™¨ã€‚ å¯è¿­ä»£å¯¹è±¡å¯ä»¥é€šè¿‡Iter()å‡½æ•°è½¬åŒ–ä¸ºè¿­ä»£å™¨ã€‚ å¯è¿­ä»£å¯¹è±¡ä¸€å®šå¯ä»¥ä½¿ç”¨forå¾ªç¯è¿­ä»£ï¼Œèƒ½ä½¿ç”¨forå¾ªç¯è¿­ä»£çš„ä¸ä¸€å®šæ˜¯å¯è¿­ä»£å¯¹è±¡ å¯è¿­ä»£å¯¹è±¡(Iterable)å…ˆæ¥çœ‹å¯è¿­ä»£å¯¹è±¡, ç®€å•æ¥è¯´åœ¨pythonä¸­çš„ä¸€ä¸ªå¯¹è±¡å¦‚æœå®ç°äº†__iter__()æ–¹æ³•(è¿™ä¸ªæ–¹æ³•çš„å…·ä½“ä½œç”¨æ”¾åˆ°åé¢è¯´)ï¼Œé‚£ä¸ªè¿™ä¸ªå¯¹è±¡å°±æ˜¯å¯è¿­ä»£å¯¹è±¡(Iterable)ã€‚ä¾‹å¦‚å¸¸è§çš„å¯è¿­ä»£å¯¹è±¡æœ‰ï¼š é›†åˆæˆ–åºåˆ—(å¦‚listã€tupleã€setã€dictã€str) æ–‡ä»¶å¯¹è±¡ å®ç°äº†__iter__()æ–¹æ³•çš„å¯¹è±¡ æ¥éªŒè¯ä¸€ä¸‹ä¸Šè¿°æåˆ°çš„æ˜¯å¦çœŸçš„æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯å¦éƒ½å®ç°äº†__iter__()æ–¹æ³• ä½¿ç”¨pythonå†…ç½®çš„isinstanceå¯ä»¥ç”¨æ¥éªŒè¯å¯¹è±¡æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚ä½¿ç”¨å†…ç½®hasattrå‡½æ•°æ¥éªŒè¯å¯¹è±¡æ˜¯å¦å®ç°äº†__iter__æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132from collections.abc import Iterable# éªŒè¯åˆ—è¡¨print(hasattr([], &quot;__iter__&quot;)) # print trueprint(isinstance([], Iterable)) # print true# éªŒè¯å…ƒç»„print(hasattr((), &quot;__iter__&quot;)) # print trueprint(isinstance((), Iterable)) # print true# éªŒè¯é›†åˆprint(hasattr(set(), &quot;__iter__&quot;)) # print trueprint(isinstance(set(), Iterable)) # print true# éªŒè¯å­—å…¸print(hasattr(dict(), &quot;__iter__&quot;)) # print trueprint(isinstance(dict(), Iterable)) # print true# éªŒè¯å­—ç¬¦åˆ›print(hasattr(&quot;&quot;, &quot;__iter__&quot;)) # print trueprint(isinstance(&quot;&quot;, Iterable)) # print true# éªŒè¯æ–‡ä»¶å¯¹è±¡with open(&quot;hello.py&quot;, &quot;w&quot;) as f: print(hasattr(f, &quot;__iter__&quot;)) # print true print(isinstance(f, Iterable)) # print true# æˆ‘ä»¬è‡ªå·±æ¥å®ç°ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ class IterObj(object): def __iter__(self): # æ³¨æ„ è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœè¿™ä¸ªç±»çš„å®ä¾‹åŒ–å¯¹è±¡æ‹¿åˆ°forå¾ªç¯é‡Œæ˜¯ä¼šæŠ¥é”™çš„ï¼Œä¸‹é¢å†è®²ä¸ºä»€ä¹ˆ return self# éªŒè¯å®ç°äº† __iter__çš„å¯¹è±¡obj = IterObj()print(isinstance(obj, Iterable)) # print true è¿­ä»£å™¨(Iterator)å†æ¥çœ‹ä¸€ä¸‹è¿­ä»£å™¨çš„æ¦‚å¿µï¼Œç®€å•æ¥è¯´ï¼Œä¸€ä¸ªå¯¹è±¡å®ç°äº† __iter__å’Œ__next__æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€æ®µä»£ç ä¸­è‡ªå·±å®ç°çš„å¯è¿­ä»£å¯¹è±¡Iterableåªè¦å†åŠ ä¸Šä¸€ä¸ª__next__æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®ä¾‹åŒ–å¯¹è±¡å°±å¯ä»¥ç§°ä¸ºä¸€ä¸ªè¿­ä»£å™¨ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pythonçš„å†…ç½®å‡½æ•°nextå¯¹è¿­ä»£å™¨è¿›è¡Œè°ƒç”¨ï¼Œåªåˆ°è¿­ä»£å™¨æŠ›å‡ºå¼‚å¸¸StopIterationã€‚ä¾‹å¦‚ï¼š 1234567891011121314151617181920212223class IterObj(object): def __init__(self): self.arr = [1, 2, 3] self.length = len(self.arr) self.i = 0 def __iter__(self): return iter(self.arr) def __next__(self): while self.i &lt; self.length: self.i += 1 return self.arr[self.i - 1] else: self.i = 0 raise StopIteration()obj = IterObj()print(next(obj)) # print 1print(next(obj)) # print 2print(next(obj)) # pinrt 3print(next(obj)) # æŠ›å‡ºå¼‚å¸¸ åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œåœ¨__iter__æ–¹æ³•ä¸­æˆ‘ä»¬è¿”å›äº†iter(self.arr)ã€‚é‚£ä¹ˆè¿™ä¸ªiter()æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ __iter__å’Œiter()å‰é¢å·²ç»è¯´è¿‡äº†ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†__iter__æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚é‚£è¿™ä¸ªæ–¹æ³•å…·ä½“åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨(Iterator). iter()è¿™ä¸ªå†…ç½®å‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚å®ƒçš„å·¥ä½œè¿‡ç¨‹æ˜¯ï¼Œå…ˆè®¿é—®å¯¹è±¡çš„__iter__æ–¹æ³•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è®¿é—®__getitem__æ–¹æ³•ã€‚è¿™å°±æ˜¯ç»“è®º2 çš„ç”±æ¥ã€‚ é‚£è¿™ä¸ªIter()æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿåªæœ‰æˆ‘ä»¬æ˜¾å¼çš„è°ƒç”¨å—ï¼Ÿæˆ‘ä»¬å›é¡¾ä¸€ä¸‹å¯¹åˆ—è¡¨çš„ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼š ä½¿ç”¨forå¾ªç¯å¯¹å…¶è¿›è¡Œè¿­ä»£ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œforå¾ªç¯çš„å·¥ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œæˆ–è€…å¯¹è±¡æ˜¯å¦å®ç°äº†__getitem__()æ–¹æ³•(å…ˆç•™ä¸ªå‘å¾…ä¼šå†å¡«)ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œåˆ™å¯¹å¯¹è±¡è°ƒç”¨Iteræ–¹æ³•ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬è‡ªå·±å®ç°çš„ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯__iter__è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚ ä¸æ–­çš„è°ƒç”¨è¿­ä»£å™¨é‡Œçš„__next__æ–¹æ³•ï¼Œè¿”å›è¿­ä»£å™¨é‡Œçš„ä¸€ä¸ªå€¼ã€‚ è¿­ä»£çš„æœ€åï¼Œè¿­ä»£å™¨é‡Œæ²¡æœ‰å…ƒç´ äº†ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œforå¾ªç¯ç»“æŸã€‚ å¯¹äºå…¶ä»–çš„å¯è¿­ä»£å¯¹è±¡ï¼Œè¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¼„æ˜ç™½forå¾ªç¯çš„å·¥ä½œåŸç†åï¼Œå°±å¯ä»¥æ¥åŠ¨æ‰‹å®ç°ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡äº†ã€‚ é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·²æœ‰çš„å¯è¿­ä»£å¯¹è±¡æ¥è¾…åŠ©æˆ‘ä»¬å®ç°è‡ªå®šä¹‰çš„å¯è¿­ä»£å¯¹è±¡ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡åŒæ—¶å®ç°__next__å’Œ__iter__æ¥è‡ªå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨(Iterator)ã€‚ 123456789101112131415161718192021222324252627282930313233# å€ŸåŠ©å·²çŸ¥çš„å¯è¿­ä»£å¯¹è±¡æ¥è‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡class MyList(): def __init__(self): self.my_list = [1, 2, 3] def __iter__(self): return iter(self.my_list)# åŒæ—¶å®ç° `__next__`å’Œ`__iter__`æ¥è‡ªå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨(`Iterator`)ã€‚class MyRange(): def __init__(self, num): self.i = 0 self.num = num def __iter__(self): return self def __next__(self): if self.i &lt; self.num: res = self.i self.i += 1 return res else: raise StopIterationmy_iterable = MyRange(10)for i in my_iterable: print(i) # æ‰“å°0-9my_iterable = MyList()for i in my_iterable: print(i) # æ‰“å° 1-3 ç”Ÿæˆå™¨(generator`)ç”Ÿæˆå™¨æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚å®ƒä¹Ÿå¯ä»¥ç”¨åœ¨è¿­ä»£çš„æ“ä½œä¸­ï¼Œå®ƒå’Œè¿­ä»£å™¨çš„åŒºåˆ«æ˜¯ï¼Œå®ƒæ˜¯ä¸€éè¿­ä»£ä¸€éè®¡ç®—ã€‚åœ¨å¯¹ç”Ÿæˆå™¨è°ƒç”¨next()å‡½æ•°æ—¶ï¼Œç”Ÿæˆå™¨æ‰ä¼šè®¡ç®—éœ€è¦è¿”å›çš„å€¼ï¼Œåœ¨è¿™ä¹‹å‰éœ€è¦è¿”å›çš„å€¼æ˜¯ä¸å­˜åœ¨çš„ï¼Œè€Œè¿­ä»£å™¨åœ¨è°ƒç”¨next()å‡½æ•°å‰ï¼Œè¿”å›å€¼å·²ç»å­˜åœ¨äº†ã€‚ å®šä¹‰ç”Ÿæˆå™¨æœ‰ä¸¤ç§æ–¹å¼: åˆ—è¡¨ç”Ÿæˆå™¨ ä½¿ç”¨yieldå®šä¹‰ç”Ÿæˆå™¨å‡½æ•° ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå™¨1234567gen = (i*i for i in range(3)) # éœ€è¦æŠŠåˆ—è¡¨ç”Ÿæˆå™¨çš„[]æ”¹ä¸º()print(next(gen)) # print 0print(next(gen)) # print 1print(next(gen)) # pirnt 4# ä¹Ÿå¯ä»¥ä½¿ç”¨forå¾ªç¯for i in gen: print(i) ä½¿ç”¨yieldå…³é”®å­—ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼š 123456789def fib(n): prev, curr = 0, 1 while n &gt; 0: n -= 1 yield curr prev, curr = curr, curr + prevprint([i for i in fib(10)])#[1, 1, 2, 3, 5, 8, 13, 21, 34, 55] å¦å¤–pythonä½¿ç”¨ç”Ÿæˆå™¨çš„ç‰¹ç‚¹å®ç°äº†åç¨‹ï¼Œå®ƒç›¸å¯¹äºçº¿ç¨‹å¤„ç†é«˜å¹¶å‘åœºæ™¯å…·æœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚","link":"/posts/951a8626.html"},{"title":"è¸©å‘-pythonåˆ›å»ºäºŒç»´æ•°ç»„","text":"åœ¨åšä¸€é“åŠ¨æ€è§„åˆ’çš„é¢˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚çœ‹åˆ°äºŒç»´æ•°ç»„å¾ˆå¿«å°±èƒ½æƒ³åˆ°å¯ä»¥ç”¨åµŒå¥—çš„listæ¥å®ç°ï¼Œä½†æ˜¯è¿™é‡Œé¢æ˜¯æœ‰ä¸ªå‘çš„ã€‚ ä¾‹å¦‚åˆ›å»ºä¸€ä¸ª4X4çš„äºŒç»´æ•°ç»„ï¼Œå…¨éƒ¨å€¼ç½®ä¸º1. é”™è¯¯çš„ä»£ç ï¼š1a = [[1]*4]*4 # ç±»ä¼¼äº â€˜+â€™*100 è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œçœ‹èµ·æ¥ä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰ï¼ 1a = [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]] æ¥ç€å¯¹aä¸­æŸä¸ªå•ç‹¬çš„å€¼è¿›è¡Œä¿®æ”¹ã€‚ 123print(&quot;a = &quot;, a) # aåŸæ¥çš„å€¼a[2][2] = 2print('a = ', a) # ä¿®æ”¹åaçš„å€¼ è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 12a = [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]] # ä¿®æ”¹açš„å€¼a = [[1, 1, 2, 1], [1, 1, 2, 1], [1, 1, 2, 1], [1, 1, 2, 1]] # ä¿®æ”¹åaçš„å€¼ å¯¹æ¯”ä¸€ä¸‹ï¼Œa[2][2] = 2è¿™ä¸ªæ“ä½œå®ƒä¿®æ”¹äº†a[2]è€Œä¸æ˜¯a[2][2].ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼ŸæƒŠå–œï¼ï¼ï¼ æ­£ç¡®çš„æ–¹æ³• åˆ—è¡¨ç”Ÿæˆå¼ 1a = [[1 for i in range(4)] for j in range(4)] åˆ—è¡¨ç”Ÿæˆå¼çœŸçš„å¤ªæœ‰ç”¨äº†ï¼ï¼ï¼ ä½¿ç”¨numpyæ¨¡å—åˆ›å»º 12import numpy as np # éœ€è¦å®‰è£…numpya = np.ones(16).reshape(4,4) è§£é‡Šlist * n ç›¸å½“äºæ˜¯ nä¸ªlistçš„æµ…æ‹·è´çš„è¿æ¥ã€‚ä¸‹é¢ä»£ç æ‰“å°äº†aä¸­æ¯ä¸ªå­åˆ—è¡¨çš„idå€¼ã€‚ 12for i in range(4): print(id(a[i])) ç»“æœå¦‚ä¸‹ï¼š 12344460725424446072542444607254244460725424 å¯ä»¥çœ‹åˆ°aä¸­æ¯ä¸ªå­åˆ—è¡¨çš„idå€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œå³å®ƒä»¬å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªåˆ—è¡¨ã€‚å½“å¯¹å…¶ä¸­çš„æŸä¸ªå­åˆ—è¡¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå…¶å®ƒå­åˆ—è¡¨è‡ªç„¶ä¹Ÿæ”¹å˜äº†ã€‚","link":"/posts/d9568da.html"}],"tags":[{"name":"AES","slug":"AES","link":"/tags/AES/"},{"name":"MD5","slug":"MD5","link":"/tags/MD5/"},{"name":"flask","slug":"flask","link":"/tags/flask/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/tags/%E7%88%AC%E8%99%AB/"},{"name":"Python","slug":"Python","link":"/tags/Python/"},{"name":"picgo","slug":"picgo","link":"/tags/picgo/"},{"name":"å›¾åºŠ","slug":"å›¾åºŠ","link":"/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"macä½¿ç”¨æŠ€å·§","slug":"macä½¿ç”¨æŠ€å·§","link":"/tags/mac%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","link":"/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æéªŒ","slug":"æéªŒ","link":"/tags/%E6%9E%81%E9%AA%8C/"},{"name":"ast","slug":"ast","link":"/tags/ast/"},{"name":"APPé€†å‘","slug":"APPé€†å‘","link":"/tags/APP%E9%80%86%E5%90%91/"},{"name":"unidbg","slug":"unidbg","link":"/tags/unidbg/"}],"categories":[{"name":"JSé€†å‘","slug":"JSé€†å‘","link":"/categories/JS%E9%80%86%E5%90%91/"},{"name":"Python","slug":"Python","link":"/categories/Python/"},{"name":"å½’æ¡£","slug":"å½’æ¡£","link":"/categories/%E5%BD%92%E6%A1%A3/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/categories/%E7%88%AC%E8%99%AB/"}],"pages":[]}